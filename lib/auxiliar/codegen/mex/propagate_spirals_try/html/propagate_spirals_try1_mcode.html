<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T1U3">Time</span>, <span class="var type1" id="S3T1U4">v</span>, <span class="var type1" id="S4T1U5">r</span>, <span class="var type1" id="S5T1U6">theta</span>, <span class="var type1" id="S6T1U7">psi</span> , <span class="var type1" id="S7T1U8">flag</span> ] = propagate_spirals_try( <span class="var type1" id="S8T1U11">v0</span> ,<span class="var type1" id="S9T1U12">r0</span>, <span class="var type1" id="S10T1U13">theta0</span>, <span class="var type1" id="S11T1U14">psi0</span>, <span class="var type1" id="S12T1U15">thetaf</span>, <span class="var type1" id="S13T1U16">ee</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%              CONTROLLED GENERALIZED LOGARITHMIC SPIRALS</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%                   Written by David Morante (UC3M)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%                        dmorante@ing.uc3m.es</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="comment">% INPUTS ::</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%        r0      :: Initial Radius</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%        v0      :: Magnitude of the initial velocity</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%        theta0  :: Initial Polar angle [radians]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%        psi0    :: Initial Flight Path angle</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%        thetaf  :: Final value of the polar angle [radians]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%        ee      :: The spiral control parameter</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%        Npoints :: Orientations at which the state is to be computed (scalar or vector)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">% OUTPUTS ::</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%        theta  :: Npoints Polar angles between theta0 and thetaf</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%        r      :: Radius at polar angles theta</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%        v      :: Velocity at polar angles theta</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%        psi    :: Flight Path angle at polar angles theta</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%        Time   :: Time of flight at polar angles theta</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%        Flag   :: Status of the propagation. Posible values:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%               1 --&gt; Normal Propagation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%              -1 --&gt; Asymptote exceeded. Reduce the value of thetaf</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">% Equations are based on Roa et al. (Nov.15)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">% 'Controlled generalized logarithmic spirals for low-thrust mission desing'</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">% NOTE 1 ! ALL VARIBLES SHOULD NON-DIMENSIONAL GIVEN THAT mu=1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">% NOTE 2 ! ee = 1/2 correspond to the tangential steering case</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">% NOTE 3 ! We consider that when phi0 = pi/2 we are in raising regime</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">% Initialized Status Variable</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"><span class="mxinfo " id="T1:U13"><span class="var type1" id="S7T1U19">flag</span>  = <span class="mxinfo " id="T1:U15">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"><span class="mxinfo " id="T1:U16"><span class="var type1" id="S14T1U23">PI</span>    = <span class="mxinfo " id="T1:U18">3.14159265358979D0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo " id="T1:U19"><span class="var type1" id="S2T1U27">Time</span>  = <span class="mxinfo " id="T1:U21">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"><span class="mxinfo " id="T1:U22"><span class="var type1" id="S15T1U31">Npoints</span> = <span class="mxinfo " id="T1:U24">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">% Get the constants of Motion</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"><span class="mxinfo " id="T1:U25"><span class="var type1" id="S16T1U35">K1</span>    = <span class="mxinfo " id="T1:U27"><span class="mxinfo " id="T1:U28"><span class="var type1" id="S8T1U38">v0</span>*<span class="var type1" id="S8T1U39">v0</span></span> - <span class="mxinfo " id="T1:U31"><span class="mxinfo " id="T1:U32"><span class="mxinfo " id="T1:U33">2</span>*(<span class="mxinfo " id="T1:U34"><span class="mxinfo " id="T1:U35">1</span>-<span class="var type1" id="S13T1U46">ee</span></span>)</span>/<span class="var type1" id="S9T1U47">r0</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="mxinfo " id="T1:U38"><span class="var type1" id="S17T1U50">K2</span>    = <span class="mxinfo " id="T1:U40"><span class="mxinfo " id="T1:U41"><span class="mxinfo " id="T1:U42"><span class="var type1" id="S8T1U54">v0</span>*<span class="var type1" id="S8T1U55">v0</span></span>*<span class="var type1" id="S9T1U56">r0</span></span>*<span class="mxinfo " id="T1:U46">sin(<span class="var type1" id="S11T1U59">psi0</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"><span class="mxinfo " id="T1:U48"><span class="var type1" id="S5T1U62">theta</span> = <span class="mxinfo " id="T1:U50">linspace(<span class="var type1" id="S10T1U65">theta0</span>,<span class="var type1" id="S12T1U66">thetaf</span>,<span class="var type1" id="S15T1U67">Npoints</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">% if K2 &lt; 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%     flag = -1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">% %</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">% if K1 &lt; -abs(eps) &amp;&amp; K2 &gt; 2 * ( 1 - ee )</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%     flag = -1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">% %</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">% if K1 &lt; -abs(eps) &amp;&amp; K2 &gt; K1 * r0 + 2 * ( 1 - ee )</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">%     flag = -1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">% %</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">% if K1 &gt; abs(eps) &amp;&amp; r0 &lt; ( K2 - 2 * ( 1 - ee )) / K1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">%     flag = -1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">% if abs(K1)&lt; abs(eps)&amp;&amp; K2 ==1 &amp;&amp; ee == 0.5</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%     flag = -1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">% Get the initial Regime (+1--&gt; Raising; -1 --&gt; Lowering)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="mxinfo " id="T1:U54"><span class="var type1" id="S20T1U70">regime0</span> = <span class="mxinfo " id="T1:U56">sign(<span class="mxinfo " id="T1:U57">cos(<span class="var type1" id="S11T1U75">psi0</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T2:U59"><span class="var type1" id="S7T1U79">flag</span> == <span class="mxinfo " id="T1:U61">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T2:U62"><span class="var type1" id="S16T1U84">K1</span>  &lt; <span class="mxinfo " id="T1:U64">0</span></span> <span class="comment">% Elliptical spiral</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line">        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line">        <span class="comment">% THE PARTICLE NEVER SCAPE (rmax) when propagated backward or forward</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">        <span class="comment">% The particle reach the origin of the central body</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line">        <span class="comment">% Maximum radius</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line">        <span class="mxinfo " id="T1:U65"><span class="var type1" id="S23T1U88">rmax</span>    = <span class="mxinfo " id="T1:U67">( <span class="mxinfo " id="T1:U68"><span class="mxinfo " id="T1:U69"><span class="mxinfo " id="T1:U70">2</span> * ( <span class="mxinfo " id="T1:U71"><span class="mxinfo " id="T1:U72">1</span>- <span class="var type1" id="S13T1U97">ee</span></span>)</span> - <span class="var type1" id="S17T1U98">K2</span></span> ) / ( <span class="mxinfo " id="T1:U75">-<span class="var type1" id="S16T1U101">K1</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">        <span class="mxinfo " id="T1:U77"><span class="var type1" id="S24T1U104">ell</span>     = <span class="mxinfo " id="T1:U79"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U80"><span class="mxinfo " id="T1:U81"><span class="mxinfo " id="T1:U82">4</span> * <span class="mxinfo " id="T1:U83"><span class="potentialdiff PD1">( <span class="mxinfo " id="T1:U84"><span class="mxinfo " id="T1:U85">1</span> - <span class="var type1" id="S13T1U114">ee</span></span> )^2</span></span></span> - <span class="mxinfo " id="T1:U87"><span class="potentialdiff PD1"><span class="var type1" id="S17T1U117">K2</span>^2</span></span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">        <span class="comment">% Axis of symmetry</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">        <span class="mxinfo " id="T1:U89"><span class="var type1" id="S26T1U121">thetam</span>  = <span class="mxinfo " id="T1:U91"><span class="var type1" id="S10T1U123">theta0</span> + <span class="mxinfo " id="T1:U93"><span class="mxinfo " id="T1:U94"><span class="mxinfo " id="T1:U95"><span class="var type1" id="S20T1U127">regime0</span> * <span class="var type1" id="S17T1U128">K2</span></span> / <span class="var type1" id="S24T1U129">ell</span></span> * <span class="mxinfo " id="T1:U99">abs( <span class="mxinfo " id="T1:U100"><span class="potentialdiff PD1">acosh ( <span class="mxinfo " id="T1:U101"><span class="mxinfo " id="T1:U102"><span class="var type1" id="S23T1U136">rmax</span> / <span class="var type1" id="S9T1U137">r0</span></span> - <span class="mxinfo " id="T1:U105"><span class="mxinfo " id="T1:U106"><span class="mxinfo " id="T1:U107"><span class="mxinfo " id="T1:U108">2</span> * ( <span class="mxinfo " id="T1:U109"><span class="mxinfo " id="T1:U110">1</span> - <span class="var type1" id="S13T1U145">ee</span></span>)</span> / <span class="var type1" id="S17T1U146">K2</span></span> * ( <span class="mxinfo " id="T1:U113"><span class="mxinfo " id="T1:U114">1</span> - <span class="mxinfo " id="T1:U115"><span class="var type1" id="S23T1U151">rmax</span> / <span class="var type1" id="S9T1U152">r0</span></span></span>)</span></span> )</span></span>)</span></span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">        <span class="comment">% Regime at each theta</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line">        <span class="mxinfo " id="T1:U118"><span class="var type1" id="S29T1U155">regime</span>  = <span class="mxinfo " id="T1:U120"><span class="mxinfo " id="T1:U121">-1 * (<span class="mxinfo " id="T2:U122"><span class="var type1" id="S5T1U162">theta</span> &gt; <span class="var type1" id="S26T1U163">thetam</span></span>)</span> + <span class="mxinfo " id="T1:U125">1 * (<span class="mxinfo " id="T2:U126"><span class="var type1" id="S5T1U168">theta</span> &lt;= <span class="var type1" id="S26T1U169">thetam</span></span>)</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">        <span class="comment">% Compute Trajectory</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">        <span class="mxinfo " id="T1:U129"><span class="var type1" id="S30T1U172">beta</span>    = <span class="mxinfo " id="T1:U131"><span class="mxinfo " id="T1:U132"><span class="var type1" id="S24T1U175">ell</span> / <span class="var type1" id="S17T1U176">K2</span></span> * ( <span class="mxinfo " id="T1:U135"><span class="var type1" id="S5T1U179">theta</span> - <span class="var type1" id="S26T1U180">thetam</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">        <span class="mxinfo " id="T1:U138"><span class="var type1" id="S4T1U183">r</span>       = <span class="mxinfo " id="T1:U140"><span class="mxinfo " id="T1:U141"><span class="var type1" id="S23T1U186">rmax</span> * ( <span class="mxinfo " id="T1:U143"><span class="mxinfo " id="T1:U144"><span class="mxinfo " id="T1:U145">2</span> * ( <span class="mxinfo " id="T1:U146"><span class="mxinfo " id="T1:U147">1</span> - <span class="var type1" id="S13T1U194">ee</span></span>)</span> + <span class="var type1" id="S17T1U195">K2</span></span> )</span> ./ ( <span class="mxinfo " id="T1:U150"><span class="mxinfo " id="T1:U151"><span class="mxinfo " id="T1:U152">2</span> * ( <span class="mxinfo " id="T1:U153"><span class="mxinfo " id="T1:U154">1</span> - <span class="var type1" id="S13T1U203">ee</span></span> )</span> + <span class="mxinfo " id="T1:U156"><span class="var type1" id="S17T1U205">K2</span> * <span class="mxinfo " id="T1:U158">cosh ( <span class="var type1" id="S30T1U208">beta</span> )</span></span></span> )</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">        <span class="mxinfo " id="T1:U160"><span class="var type1" id="S3T1U211">v</span>       = <span class="mxinfo " id="T1:U162"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U163"><span class="var type1" id="S16T1U215">K1</span> + <span class="mxinfo " id="T1:U165"><span class="mxinfo " id="T1:U166"><span class="mxinfo " id="T1:U167">2</span> ./ <span class="var type1" id="S4T1U219">r</span></span> * ( <span class="mxinfo " id="T1:U169"><span class="mxinfo " id="T1:U170">1</span> - <span class="var type1" id="S13T1U223">ee</span></span> )</span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">        <span class="mxinfo " id="T1:U172"><span class="var type1" id="S32T1U226">cpsi</span>    =  <span class="mxinfo " id="T1:U174"><span class="var type1" id="S29T1U228">regime</span> .* ( <span class="mxinfo " id="T1:U176"><span class="mxinfo " id="T1:U177"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U178"><span class="mxinfo " id="T1:U179"><span class="potentialdiff PD1">( <span class="mxinfo " id="T1:U180"><span class="mxinfo " id="T1:U181"><span class="mxinfo " id="T1:U182">2</span> * ( <span class="mxinfo " id="T1:U183"><span class="mxinfo " id="T1:U184">1</span> - <span class="var type1" id="S13T1U242">ee</span></span> )</span> +  <span class="mxinfo " id="T1:U186"><span class="var type1" id="S16T1U244">K1</span> * <span class="var type1" id="S4T1U245">r</span></span></span> ).^2</span></span> - <span class="mxinfo " id="T1:U189"><span class="potentialdiff PD1"><span class="var type1" id="S17T1U248">K2</span>^2</span></span></span> )</span></span> ./ ( <span class="mxinfo " id="T1:U191"><span class="mxinfo " id="T1:U192"><span class="mxinfo " id="T1:U193">2</span> * ( <span class="mxinfo " id="T1:U194"><span class="mxinfo " id="T1:U195">1</span> - <span class="var type1" id="S13T1U257">ee</span></span> )</span> + <span class="mxinfo " id="T1:U197"><span class="var type1" id="S16T1U259">K1</span> * <span class="var type1" id="S4T1U260">r</span></span></span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line">        <span class="mxinfo " id="T1:U200"><span class="var type1" id="S33T1U263">spsi</span>    =  <span class="mxinfo " id="T1:U202"><span class="var type1" id="S17T1U265">K2</span> ./ ( <span class="mxinfo " id="T1:U204"><span class="mxinfo " id="T1:U205"><span class="mxinfo " id="T1:U206">2</span> * ( <span class="mxinfo " id="T1:U207"><span class="mxinfo " id="T1:U208">1</span> - <span class="var type1" id="S13T1U273">ee</span></span> )</span> + <span class="mxinfo " id="T1:U210"><span class="var type1" id="S16T1U275">K1</span> * <span class="var type1" id="S4T1U276">r</span></span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line">        <span class="mxinfo " id="T1:U213"><span class="var type1" id="S6T1U279">psi</span>     =  <span class="mxinfo " id="T1:U215">atan2( real(<span class="var type1" id="S33T1U284">spsi</span>), real(<span class="var type1" id="S32T1U287">cpsi</span>))</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line">        <span class="comment">% Time of flight</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line">        <span class="mxinfo " id="T1:U218"><span class="var type1" id="S36T1U290">vm</span>      = <span class="mxinfo " id="T1:U220"><span class="potentialdiff PD1">sqrt(  <span class="mxinfo " id="T1:U221"><span class="var type1" id="S17T1U294">K2</span> / <span class="var type1" id="S23T1U295">rmax</span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line">        <span class="mxinfo " id="T1:U224"><span class="var type1" id="S37T1U298">kk</span>      = <span class="mxinfo " id="T1:U226"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U227"><span class="mxinfo " id="T1:U228"><span class="mxinfo " id="T1:U229">-<span class="var type1" id="S16T1U304">K1</span></span> * <span class="var type1" id="S23T1U305">rmax</span></span> / ( <span class="mxinfo " id="T1:U232"><span class="mxinfo " id="T1:U233">4</span> * ( <span class="mxinfo " id="T1:U234"><span class="mxinfo " id="T1:U235">1</span> - <span class="var type1" id="S13T1U312">ee</span></span> )</span> )</span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line">        <span class="mxinfo " id="T1:U237"><span class="var type1" id="S38T1U315">kp</span>      = <span class="mxinfo " id="T1:U239"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U240"><span class="mxinfo " id="T1:U241">1</span> - <span class="mxinfo " id="T1:U242"><span class="potentialdiff PD1"><span class="var type1" id="S37T1U321">kk</span>^2</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line">        <span class="mxinfo " id="T1:U244"><span class="var type1" id="S39T1U325">nn</span>      = <span class="mxinfo " id="T1:U246"><span class="mxinfo " id="T1:U247"><span class="var type1" id="S16T1U328">K1</span> * <span class="var type1" id="S23T1U329">rmax</span></span> / ( <span class="mxinfo " id="T1:U250"><span class="mxinfo " id="T1:U251">2</span> * <span class="var type1" id="S17T1U333">K2</span></span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">        <span class="comment">% Elliptic integrals</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">        <span class="mxinfo " id="T1:U253"><span class="var type1" id="S40T1U336">phi0</span>    = real ( <span class="mxinfo " id="T1:U255"><span class="potentialdiff PD1">asin ( <span class="mxinfo " id="T1:U256"><span class="mxinfo " id="T1:U257"><span class="var type1" id="S36T1U343">vm</span> / <span class="var type1" id="S8T1U344">v0</span></span> * <span class="mxinfo " id="T1:U260"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U261"><span class="mxinfo " id="T1:U262">2</span> / ( <span class="mxinfo " id="T1:U263"><span class="mxinfo " id="T1:U264">1</span> + <span class="mxinfo " id="T1:U265">sin( <span class="var type1" id="S11T1U354">psi0</span> )</span></span> )</span> )</span></span></span> )</span></span> )</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">        [<span class="mxinfo " id="T1:U267">~</span>,<span class="var type1" id="S42T1U359">E01</span>] = <span class="fcn" id="F106N3:B361">ELIT</span>(<span class="var type1" id="S37T1U362">kk</span>,<span class="mxinfo " id="T1:U270">90.0</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">        [<span class="mxinfo " id="T1:U271">~</span>,<span class="var type1" id="S44T1U368">E02</span>] = <span class="fcn" id="F106N3:B370">ELIT</span>(<span class="var type1" id="S37T1U371">kk</span>,<span class="mxinfo " id="T1:U274"><span class="mxinfo " id="T1:U275"><span class="var type1" id="S40T1U374">phi0</span>*<span class="mxinfo " id="T1:U277">180</span></span>/<span class="var type1" id="S14T1U376">PI</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line">        <span class="mxinfo " id="T1:U279"><span class="var type1" id="S45T1U379">Pi01</span> = <span class="mxinfo " id="T1:U281"><span class="fcn" id="F107N4:B381">ELIT3</span>(<span class="mxinfo " id="T1:U282">90.0</span>,<span class="var type1" id="S37T1U383">kk</span>,<span class="var type1" id="S39T1U384">nn</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line">        <span class="mxinfo " id="T1:U285"><span class="var type1" id="S47T1U387">Pi02</span> = <span class="mxinfo " id="T1:U287"><span class="fcn" id="F107N4:B389">ELIT3</span>(<span class="mxinfo " id="T1:U288"><span class="mxinfo " id="T1:U289"><span class="var type1" id="S40T1U392">phi0</span>*<span class="mxinfo " id="T1:U291">180</span></span>/<span class="var type1" id="S14T1U394">PI</span></span>,<span class="var type1" id="S37T1U395">kk</span>,<span class="var type1" id="S39T1U396">nn</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line">        <span class="mxinfo " id="T1:U295"><span class="var type1" id="S48T1U399">E0</span>      = <span class="mxinfo " id="T1:U297"><span class="var type1" id="S44T1U401">E02</span>-<span class="var type1" id="S42T1U402">E01</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line">        <span class="mxinfo " id="T1:U300"><span class="var type1" id="S49T1U405">Pi0</span>     = <span class="mxinfo " id="T1:U302"><span class="var type1" id="S47T1U407">Pi02</span>-<span class="var type1" id="S45T1U408">Pi01</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">        <span class="mxinfo " id="T1:U305"><span class="var type1" id="S50T1U411">phi</span>     = real(<span class="mxinfo " id="T1:U307"><span class="potentialdiff PD1">asin ( <span class="mxinfo " id="T1:U308"><span class="mxinfo " id="T1:U309"><span class="var type1" id="S36T1U418">vm</span> ./ <span class="var type1" id="S3T1U419">v</span></span> .* <span class="mxinfo " id="T1:U312"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U313"><span class="mxinfo " id="T1:U314">2</span> ./ ( <span class="mxinfo " id="T1:U315"><span class="mxinfo " id="T1:U316">1</span> + <span class="mxinfo " id="T1:U317">sin( <span class="var type1" id="S6T1U429">psi</span> )</span></span> )</span> )</span></span></span> )</span></span>)</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line">        [<span class="mxinfo " id="T1:U319">~</span>,<span class="var type1" id="S51T1U434">E03</span>] = <span class="fcn" id="F106N3:B436">ELIT</span>(<span class="var type1" id="S37T1U437">kk</span>,<span class="mxinfo " id="T1:U322"><span class="mxinfo " id="T1:U323"><span class="var type1" id="S50T1U440">phi</span>*<span class="mxinfo " id="T1:U325">180</span></span>/<span class="var type1" id="S14T1U442">PI</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line">        <span class="mxinfo " id="T1:U327"><span class="var type1" id="S52T1U445">Pi03</span>        = <span class="mxinfo " id="T1:U329"><span class="fcn" id="F107N4:B447">ELIT3</span>(<span class="mxinfo " id="T1:U330"><span class="mxinfo " id="T1:U331"><span class="var type1" id="S50T1U450">phi</span>*<span class="mxinfo " id="T1:U333">180</span></span>/<span class="var type1" id="S14T1U452">PI</span></span>,<span class="var type1" id="S37T1U453">kk</span>,<span class="var type1" id="S39T1U454">nn</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line">        <span class="mxinfo " id="T1:U337"><span class="var type1" id="S53T1U457">E</span>       = <span class="mxinfo " id="T1:U339"><span class="var type1" id="S51T1U459">E03</span>  - <span class="var type1" id="S42T1U460">E01</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line">        <span class="mxinfo " id="T1:U342"><span class="var type1" id="S54T1U463">Pi</span>      = <span class="mxinfo " id="T1:U344"><span class="var type1" id="S52T1U465">Pi03</span> - <span class="var type1" id="S45T1U466">Pi01</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line">        <span class="mxinfo " id="T1:U347"><span class="var type1" id="S55T1U469">K4</span>      = <span class="mxinfo " id="T1:U349"><span class="mxinfo " id="T1:U350">- <span class="var type1" id="S20T1U472">regime0</span></span> .* ( <span class="mxinfo " id="T1:U352"><span class="mxinfo " id="T1:U353"><span class="mxinfo " id="T1:U354"><span class="mxinfo " id="T1:U355"><span class="var type1" id="S9T1U478">r0</span> * <span class="var type1" id="S8T1U479">v0</span></span> / <span class="var type1" id="S16T1U480">K1</span></span> * <span class="mxinfo " id="T1:U359"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U360">( <span class="mxinfo " id="T1:U361"><span class="mxinfo " id="T1:U362">1</span> - <span class="mxinfo " id="T1:U363">sin( <span class="var type1" id="S11T1U489">psi0</span> )</span></span> ) / (<span class="mxinfo " id="T1:U365"><span class="mxinfo " id="T1:U366">1</span> + <span class="mxinfo " id="T1:U367">sin( <span class="var type1" id="S11T1U495">psi0</span> )</span></span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line">            )</span>)</span></span></span> + <span class="mxinfo " id="T1:U369">( <span class="mxinfo " id="T1:U370"><span class="mxinfo " id="T1:U371"><span class="mxinfo " id="T1:U372">2</span> * ( <span class="mxinfo " id="T1:U373"><span class="mxinfo " id="T1:U374"><span class="mxinfo " id="T1:U375"><span class="mxinfo " id="T1:U376"><span class="mxinfo " id="T1:U377">2</span> * ( <span class="mxinfo " id="T1:U378"><span class="mxinfo " id="T1:U379">1</span> - <span class="var type1" id="S13T1U510">ee</span></span> )</span> * <span class="mxinfo " id="T1:U381"><span class="potentialdiff PD1"><span class="var type1" id="S38T1U512">kp</span>^2</span></span></span> * <span class="var type1" id="S49T1U514">Pi0</span></span> - <span class="mxinfo " id="T1:U384"><span class="var type1" id="S17T1U516">K2</span> * <span class="var type1" id="S48T1U517">E0</span></span></span> )</span> * <span class="mxinfo " id="T1:U387"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U388"><span class="mxinfo " id="T1:U389">1</span> - <span class="var type1" id="S13T1U522">ee</span></span> )</span></span></span>) / ( <span class="mxinfo " id="T1:U391"><span class="mxinfo " id="T1:U392"><span class="potentialdiff PD1">( <span class="mxinfo " id="T1:U393">-<span class="var type1" id="S16T1U528">K1</span></span> )^( 1.5 )</span></span> * <span class="mxinfo " id="T1:U395"><span class="potentialdiff PD1">sqrt( <span class="var type1" id="S17T1U533">K2</span> )</span></span></span> )</span></span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line">        <span class="mxinfo " id="T1:U397"><span class="var type1" id="S2T1U536">Time</span>    =   <span class="mxinfo " id="T1:U399"><span class="var type1" id="S55T1U538">K4</span> + <span class="mxinfo " id="T1:U401"><span class="var type1" id="S29T1U540">regime</span> .* ( <span class="mxinfo " id="T1:U403"><span class="mxinfo " id="T1:U404"><span class="mxinfo " id="T1:U405"><span class="mxinfo " id="T1:U406"><span class="var type1" id="S4T1U546">r</span> .* <span class="var type1" id="S3T1U547">v</span></span> / <span class="var type1" id="S16T1U548">K1</span></span> .* <span class="mxinfo " id="T1:U410"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U411">( <span class="mxinfo " id="T1:U412"><span class="mxinfo " id="T1:U413">1</span> - <span class="mxinfo " id="T1:U414">sin( <span class="var type1" id="S6T1U557">psi</span> )</span></span> ) ./ (<span class="mxinfo " id="T1:U416"><span class="mxinfo " id="T1:U417">1</span> + <span class="mxinfo " id="T1:U418">sin( <span class="var type1" id="S6T1U563">psi</span> )</span></span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line">            )</span>)</span></span></span> + <span class="mxinfo " id="T1:U420">( <span class="mxinfo " id="T1:U421"><span class="mxinfo " id="T1:U422"><span class="mxinfo " id="T1:U423">2</span> * ( <span class="mxinfo " id="T1:U424"><span class="mxinfo " id="T1:U425"><span class="mxinfo " id="T1:U426"><span class="mxinfo " id="T1:U427"><span class="mxinfo " id="T1:U428">2</span> * ( <span class="mxinfo " id="T1:U429"><span class="mxinfo " id="T1:U430">1</span> - <span class="var type1" id="S13T1U578">ee</span></span> )</span> * <span class="mxinfo " id="T1:U432"><span class="potentialdiff PD1"><span class="var type1" id="S38T1U580">kp</span>^2</span></span></span> * <span class="var type1" id="S54T1U582">Pi</span></span> - <span class="mxinfo " id="T1:U435"><span class="var type1" id="S17T1U584">K2</span> * <span class="var type1" id="S53T1U585">E</span></span></span> )</span> * <span class="mxinfo " id="T1:U438"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U439"><span class="mxinfo " id="T1:U440">1</span> - <span class="var type1" id="S13T1U590">ee</span></span> )</span></span></span>) / ( <span class="mxinfo " id="T1:U442"><span class="mxinfo " id="T1:U443"><span class="potentialdiff PD1">( <span class="mxinfo " id="T1:U444">-<span class="var type1" id="S16T1U596">K1</span></span> )^( 1.5 )</span></span> * <span class="mxinfo " id="T1:U446"><span class="potentialdiff PD1">sqrt( <span class="var type1" id="S17T1U601">K2</span> )</span></span></span> )</span></span> )</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line">    <span class="keyword">elseif</span> <span class="mxinfo " id="T2:U448"><span class="var type1" id="S16T1U604">K1</span> &gt; <span class="mxinfo " id="T1:U450">0</span></span> <span class="comment">% Hiperbolic  Spiral</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line">        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line">        <span class="comment">% THE PARTICLE REACHES INFINITY WITH A NON-ZERO VELOCITY</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line">        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line">        <span class="keyword">if</span>  <span class="mxinfo " id="T2:U451"><span class="var type1" id="S17T1U609">K2</span> &lt; <span class="mxinfo " id="T1:U453"><span class="mxinfo " id="T1:U454">2</span> * ( <span class="mxinfo " id="T1:U455"><span class="mxinfo " id="T1:U456">1</span> - <span class="var type1" id="S13T1U615">ee</span></span> )</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line">            <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line">            <span class="comment">% Type I Hiperbolic Spiral ( It has an asymthotic value )</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line">            <span class="comment">% Raising regime[ reaches infinity ], Lowering regime[ reaches origin ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line">            <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line">            <span class="mxinfo " id="T1:U458"><span class="var type1" id="S24T1U618">ell</span>     = <span class="mxinfo " id="T1:U460"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U461"><span class="mxinfo " id="T1:U462"><span class="mxinfo " id="T1:U463">4</span> * <span class="mxinfo " id="T1:U464"><span class="potentialdiff PD1">( <span class="mxinfo " id="T1:U465"><span class="mxinfo " id="T1:U466">1</span> - <span class="var type1" id="S13T1U628">ee</span></span> )^2</span></span></span> - <span class="mxinfo " id="T1:U468"><span class="potentialdiff PD1"><span class="var type1" id="S17T1U631">K2</span>^2</span></span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line">            <span class="mxinfo " id="T1:U470"><span class="var type1" id="S56T1U635">zeta</span>    = <span class="mxinfo " id="T1:U472"><span class="mxinfo " id="T1:U473"><span class="mxinfo " id="T1:U474">2</span> * ( <span class="mxinfo " id="T1:U475"><span class="mxinfo " id="T1:U476">1</span> - <span class="var type1" id="S13T1U642">ee</span></span> )</span> + <span class="var type1" id="S24T1U643">ell</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line">            <span class="comment">% Get the Position of the Asymptote</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line">            <span class="mxinfo " id="T1:U479"><span class="var type1" id="S57T1U646">thetaAs</span> = <span class="mxinfo " id="T1:U481"><span class="var type1" id="S10T1U648">theta0</span> + <span class="mxinfo " id="T1:U483"><span class="mxinfo " id="T1:U484"><span class="mxinfo " id="T1:U485"><span class="var type1" id="S20T1U652">regime0</span> * <span class="var type1" id="S17T1U653">K2</span></span> / <span class="var type1" id="S24T1U654">ell</span></span> * <span class="mxinfo " id="T1:U489"><span class="potentialdiff PD1">log( <span class="mxinfo " id="T1:U490"><span class="mxinfo " id="T1:U491"><span class="var type1" id="S17T1U659">K2</span> * ( <span class="mxinfo " id="T1:U493"><span class="mxinfo " id="T1:U494"><span class="mxinfo " id="T1:U495"><span class="var type1" id="S56T1U664">zeta</span> - <span class="var type1" id="S24T1U665">ell</span></span> - <span class="mxinfo " id="T1:U498"><span class="var type1" id="S17T1U667">K2</span> * <span class="mxinfo " id="T1:U500">sin( <span class="var type1" id="S11T1U670">psi0</span> )</span></span></span> + <span class="mxinfo " id="T1:U502"><span class="var type1" id="S24T1U672">ell</span> * <span class="mxinfo " id="T1:U504">abs( <span class="mxinfo " id="T1:U505">cos(<span class="var type1" id="S11T1U677">psi0</span>)</span> )</span></span></span> )</span> / <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line">                ( <span class="mxinfo " id="T1:U507"><span class="mxinfo " id="T1:U508"><span class="mxinfo " id="T1:U509"><span class="var type1" id="S9T1U682">r0</span> * <span class="var type1" id="S16T1U683">K1</span></span> * <span class="var type1" id="S56T1U684">zeta</span></span> * <span class="mxinfo " id="T1:U513">sin(<span class="var type1" id="S11T1U687">psi0</span>)</span></span> )</span> )</span></span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line">            <span class="comment">% Check that the desired theta is lower than Asymtote</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">            <span class="mxinfo " id="T2:U515"><span class="keyword">if</span> (<span class="mxinfo " id="T2:U516"><span class="var type1" id="S10T1U693">theta0</span> &lt; <span class="var type1" id="S57T1U694">thetaAs</span></span>) &amp;&amp; (<span class="mxinfo " id="T2:U519"><span class="var type1" id="S57T1U697">thetaAs</span> &lt; <span class="var type1" id="S12T1U698">thetaf</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line">                <span class="mxinfo " id="T1:U522"><span class="var type1" id="S7T1U701">flag</span> = <span class="mxinfo " id="T1:U524">-<span class="mxinfo " id="T1:U525">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line">            <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line">            <span class="mxinfo " id="T1:U526"><span class="var type1" id="S30T1U706">beta</span>    = <span class="mxinfo " id="T1:U528"><span class="mxinfo " id="T1:U529"><span class="mxinfo " id="T1:U530"><span class="var type1" id="S20T1U710">regime0</span> * <span class="var type1" id="S24T1U711">ell</span></span> / <span class="var type1" id="S17T1U712">K2</span></span> * ( <span class="mxinfo " id="T1:U534"><span class="var type1" id="S57T1U715">thetaAs</span> - <span class="var type1" id="S5T1U716">theta</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line">            <span class="mxinfo " id="T1:U537"><span class="var type1" id="S4T1U719">r</span>      = <span class="mxinfo " id="T1:U539"><span class="mxinfo " id="T1:U540"><span class="var type1" id="S56T1U722">zeta</span> * <span class="mxinfo " id="T1:U542"><span class="potentialdiff PD1"><span class="var type1" id="S24T1U724">ell</span>^2</span></span></span> ./  ( <span class="mxinfo " id="T1:U544"><span class="var type1" id="S16T1U728">K1</span> * ( <span class="mxinfo " id="T1:U546"><span class="mxinfo " id="T1:U547">sinh( <span class="mxinfo " id="T1:U548"><span class="var type1" id="S30T1U734">beta</span> / <span class="mxinfo " id="T1:U550">2</span></span>)</span> .* ( <span class="mxinfo " id="T1:U551"><span class="mxinfo " id="T1:U552"><span class="mxinfo " id="T1:U553"><span class="mxinfo " id="T1:U554"><span class="mxinfo " id="T1:U555">4</span> * <span class="var type1" id="S56T1U742">zeta</span></span> * ( <span class="mxinfo " id="T1:U557"><span class="mxinfo " id="T1:U558">1</span> - <span class="var type1" id="S13T1U746">ee</span></span> )</span> * <span class="mxinfo " id="T1:U560">sinh( <span class="mxinfo " id="T1:U561"><span class="var type1" id="S30T1U750">beta</span> / <span class="mxinfo " id="T1:U563">2</span></span> )</span></span> + <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line">                <span class="mxinfo " id="T1:U564">( <span class="mxinfo " id="T1:U565"><span class="mxinfo " id="T1:U566"><span class="potentialdiff PD1"><span class="var type1" id="S56T1U756">zeta</span>^2</span></span> - <span class="mxinfo " id="T1:U568"><span class="potentialdiff PD1"><span class="var type1" id="S17T1U759">K2</span>^2</span></span></span> ) * <span class="mxinfo " id="T1:U570">cosh( <span class="mxinfo " id="T1:U571"><span class="var type1" id="S30T1U764">beta</span> / <span class="mxinfo " id="T1:U573">2</span></span> )</span></span></span> )</span> )</span> )</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line">            <span class="mxinfo " id="T1:U574"><span class="var type1" id="S3T1U768">v</span>      = <span class="mxinfo " id="T1:U576"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U577"><span class="var type1" id="S16T1U772">K1</span> + <span class="mxinfo " id="T1:U579"><span class="mxinfo " id="T1:U580"><span class="mxinfo " id="T1:U581">2</span> ./ <span class="var type1" id="S4T1U776">r</span></span> * ( <span class="mxinfo " id="T1:U583"><span class="mxinfo " id="T1:U584">1</span> - <span class="var type1" id="S13T1U780">ee</span></span> )</span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line">            <span class="mxinfo " id="T1:U586"><span class="var type1" id="S32T1U783">cpsi</span>   = <span class="mxinfo " id="T1:U588"><span class="var type1" id="S20T1U785">regime0</span> * ( <span class="mxinfo " id="T1:U590"><span class="mxinfo " id="T1:U591"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U592"><span class="mxinfo " id="T1:U593"><span class="potentialdiff PD1">( <span class="mxinfo " id="T1:U594"><span class="mxinfo " id="T1:U595"><span class="mxinfo " id="T1:U596">2</span> * ( <span class="mxinfo " id="T1:U597"><span class="mxinfo " id="T1:U598">1</span> - <span class="var type1" id="S13T1U799">ee</span></span> )</span> +  <span class="mxinfo " id="T1:U600"><span class="var type1" id="S16T1U801">K1</span> * <span class="var type1" id="S4T1U802">r</span></span></span> ).^2</span></span> - <span class="mxinfo " id="T1:U603"><span class="potentialdiff PD1"><span class="var type1" id="S17T1U805">K2</span>^2</span></span></span> )</span></span> ./ ( <span class="mxinfo " id="T1:U605"><span class="mxinfo " id="T1:U606"><span class="mxinfo " id="T1:U607">2</span> * ( <span class="mxinfo " id="T1:U608"><span class="mxinfo " id="T1:U609">1</span> - <span class="var type1" id="S13T1U814">ee</span></span> )</span> + <span class="mxinfo " id="T1:U611"><span class="var type1" id="S16T1U816">K1</span> * <span class="var type1" id="S4T1U817">r</span></span></span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line">            <span class="mxinfo " id="T1:U614"><span class="var type1" id="S33T1U820">spsi</span>   = <span class="mxinfo " id="T1:U616"><span class="var type1" id="S17T1U822">K2</span> ./ ( <span class="mxinfo " id="T1:U618"><span class="mxinfo " id="T1:U619"><span class="mxinfo " id="T1:U620">2</span> * ( <span class="mxinfo " id="T1:U621"><span class="mxinfo " id="T1:U622">1</span> - <span class="var type1" id="S13T1U830">ee</span></span> )</span> + <span class="mxinfo " id="T1:U624"><span class="var type1" id="S16T1U832">K1</span> * <span class="var type1" id="S4T1U833">r</span></span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line">            <span class="mxinfo " id="T1:U627"><span class="var type1" id="S6T1U836">psi</span>    =  <span class="mxinfo " id="T1:U629">atan2(<span class="var type1" id="S33T1U839">spsi</span> , <span class="var type1" id="S32T1U840">cpsi</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line">            <span class="comment">% Time of Flight</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line">            <span class="mxinfo " id="T1:U632"><span class="var type1" id="S37T1U843">kk</span>      =  <span class="mxinfo " id="T1:U634"><span class="mxinfo " id="T1:U635"><span class="mxinfo " id="T1:U636">1</span> / <span class="mxinfo " id="T1:U637">2</span></span> * <span class="mxinfo " id="T1:U638"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U639">( <span class="mxinfo " id="T1:U640"><span class="mxinfo " id="T1:U641"><span class="mxinfo " id="T1:U642">2</span> * ( <span class="mxinfo " id="T1:U643"><span class="mxinfo " id="T1:U644">1</span> - <span class="var type1" id="S13T1U858">ee</span></span> )</span> + <span class="var type1" id="S17T1U859">K2</span></span> ) / ( <span class="mxinfo " id="T1:U647"><span class="mxinfo " id="T1:U648">1</span> - <span class="var type1" id="S13T1U863">ee</span></span> )</span> )</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line">            <span class="mxinfo " id="T1:U650"><span class="var type1" id="S39T1U866">nn</span>      =  <span class="mxinfo " id="T1:U652">( <span class="mxinfo " id="T1:U653"><span class="mxinfo " id="T1:U654"><span class="mxinfo " id="T1:U655">2</span> * ( <span class="mxinfo " id="T1:U656"><span class="mxinfo " id="T1:U657">1</span> - <span class="var type1" id="S13T1U875">ee</span></span> )</span> + <span class="var type1" id="S17T1U876">K2</span></span> ) / ( <span class="mxinfo " id="T1:U660"><span class="mxinfo " id="T1:U661">2</span> * <span class="var type1" id="S17T1U880">K2</span></span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line">            <span class="comment">% Ellliptic integrals</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line">            <span class="mxinfo " id="T1:U663"><span class="var type1" id="S40T1U883">phi0</span>   = <span class="mxinfo " id="T1:U665"><span class="potentialdiff PD1">asin ( <span class="mxinfo " id="T1:U666"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U667"><span class="mxinfo " id="T1:U668"><span class="mxinfo " id="T1:U669"><span class="var type1" id="S16T1U891">K1</span> * <span class="var type1" id="S9T1U892">r0</span></span> * <span class="mxinfo " id="T1:U672">sin(<span class="var type1" id="S11T1U895">psi0</span>)</span></span> / ( <span class="mxinfo " id="T1:U674"><span class="mxinfo " id="T1:U675"><span class="var type1" id="S39T1U899">nn</span> * <span class="var type1" id="S17T1U900">K2</span></span> * ( <span class="mxinfo " id="T1:U678"><span class="mxinfo " id="T1:U679">1</span> - <span class="mxinfo " id="T1:U680">sin(<span class="var type1" id="S11T1U906">psi0</span>)</span></span> )</span> )</span> )</span></span> )</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line">            <span class="mxinfo " id="T1:U682"><span class="var type1" id="S50T1U909">phi</span>    = <span class="mxinfo " id="T1:U684"><span class="potentialdiff PD1">asin ( <span class="mxinfo " id="T1:U685"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U686"><span class="mxinfo " id="T1:U687"><span class="mxinfo " id="T1:U688"><span class="var type1" id="S16T1U917">K1</span> * <span class="var type1" id="S4T1U918">r</span></span> .* <span class="mxinfo " id="T1:U691">sin(<span class="var type1" id="S6T1U921">psi</span>)</span></span> ./ ( <span class="mxinfo " id="T1:U693"><span class="mxinfo " id="T1:U694"><span class="var type1" id="S39T1U925">nn</span> * <span class="var type1" id="S17T1U926">K2</span></span> * ( <span class="mxinfo " id="T1:U697"><span class="mxinfo " id="T1:U698">1</span> - <span class="mxinfo " id="T1:U699">sin(<span class="var type1" id="S6T1U932">psi</span>)</span></span> )</span> )</span> )</span></span> )</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line">            <span class="comment">% Do only if any asymptote is reached</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T2:U701"><span class="var type1" id="S7T1U936">flag</span> == <span class="mxinfo " id="T1:U703">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line">               [<span class="mxinfo " id="T1:U704">~</span>,<span class="var type1" id="S48T1U942">E0</span>] = <span class="fcn" id="F106N3:B944">ELIT</span>(<span class="var type1" id="S37T1U945">kk</span>,<span class="mxinfo " id="T1:U707"><span class="mxinfo " id="T1:U708"><span class="var type1" id="S40T1U948">phi0</span>*<span class="mxinfo " id="T1:U710">180</span></span>/<span class="var type1" id="S14T1U950">PI</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line">                <span class="mxinfo " id="T1:U712"><span class="var type1" id="S49T1U953">Pi0</span>   = <span class="mxinfo " id="T1:U714"><span class="fcn" id="F107N4:B955">ELIT3</span>(<span class="mxinfo " id="T1:U715"><span class="mxinfo " id="T1:U716"><span class="var type1" id="S40T1U958">phi0</span>*<span class="mxinfo " id="T1:U718">180</span></span>/<span class="var type1" id="S14T1U960">PI</span></span>,<span class="var type1" id="S37T1U961">kk</span>,<span class="var type1" id="S39T1U962">nn</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line">                [<span class="mxinfo " id="T1:U722">~</span>,<span class="var type1" id="S53T1U967">E</span>] = <span class="fcn" id="F106N3:B969">ELIT</span>(<span class="var type1" id="S37T1U970">kk</span>,<span class="mxinfo " id="T1:U725"><span class="mxinfo " id="T1:U726"><span class="var type1" id="S50T1U973">phi</span>*<span class="mxinfo " id="T1:U728">180</span></span>/<span class="var type1" id="S14T1U975">PI</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line">                <span class="mxinfo " id="T1:U730"><span class="var type1" id="S54T1U978">Pi</span>    = <span class="mxinfo " id="T1:U732"><span class="fcn" id="F107N4:B980">ELIT3</span>(<span class="mxinfo " id="T1:U733"><span class="mxinfo " id="T1:U734"><span class="var type1" id="S50T1U983">phi</span>*<span class="mxinfo " id="T1:U736">180</span></span>/<span class="var type1" id="S14T1U985">PI</span></span>,<span class="var type1" id="S37T1U986">kk</span>,<span class="var type1" id="S39T1U987">nn</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line">                <span class="mxinfo " id="T1:U740"><span class="var type1" id="S55T1U990">K4</span>     = <span class="mxinfo " id="T1:U742"><span class="mxinfo " id="T1:U743">- <span class="var type1" id="S20T1U993">regime0</span></span> * ( <span class="mxinfo " id="T1:U745"><span class="mxinfo " id="T1:U746"><span class="mxinfo " id="T1:U747"><span class="mxinfo " id="T1:U748"><span class="var type1" id="S9T1U999">r0</span>*<span class="var type1" id="S8T1U1000">v0</span></span> / <span class="var type1" id="S16T1U1001">K1</span></span> * <span class="mxinfo " id="T1:U752"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U753">(<span class="mxinfo " id="T1:U754"><span class="mxinfo " id="T1:U755">1</span> + <span class="mxinfo " id="T1:U756">sin(<span class="var type1" id="S11T1U1010">psi0</span>)</span></span> ) / ( <span class="mxinfo " id="T1:U758"><span class="mxinfo " id="T1:U759">1</span> - <span class="mxinfo " id="T1:U760">sin(<span class="var type1" id="S11T1U1016">psi0</span>)</span></span> )</span> )</span></span></span> - <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line">                    <span class="mxinfo " id="T1:U762"><span class="mxinfo " id="T1:U763"><span class="mxinfo " id="T1:U764"><span class="mxinfo " id="T1:U765">2</span> * ( <span class="mxinfo " id="T1:U766"><span class="var type1" id="S48T1U1023">E0</span> - <span class="mxinfo " id="T1:U768">( <span class="mxinfo " id="T1:U769"><span class="mxinfo " id="T1:U770">1</span> - <span class="var type1" id="S39T1U1028">nn</span></span> ) * <span class="var type1" id="S49T1U1029">Pi0</span></span></span> )</span> * <span class="mxinfo " id="T1:U773"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U774"><span class="var type1" id="S17T1U1033">K2</span> * ( <span class="mxinfo " id="T1:U776"><span class="mxinfo " id="T1:U777">1</span> - <span class="var type1" id="S13T1U1037">ee</span></span> )</span> )</span></span></span> / <span class="mxinfo " id="T1:U779"><span class="potentialdiff PD1"><span class="var type1" id="S16T1U1039">K1</span> ^ ( 3/2 )</span></span></span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line">                <span class="mxinfo " id="T1:U781"><span class="var type1" id="S2T1U1046">Time</span>   =  <span class="mxinfo " id="T1:U783"><span class="var type1" id="S55T1U1048">K4</span> + <span class="mxinfo " id="T1:U785"><span class="var type1" id="S20T1U1050">regime0</span> * ( <span class="mxinfo " id="T1:U787"><span class="mxinfo " id="T1:U788"><span class="mxinfo " id="T1:U789"><span class="mxinfo " id="T1:U790"><span class="var type1" id="S4T1U1056">r</span>.*<span class="var type1" id="S3T1U1057">v</span></span> / <span class="var type1" id="S16T1U1058">K1</span></span> .* <span class="mxinfo " id="T1:U794"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U795">(<span class="mxinfo " id="T1:U796"><span class="mxinfo " id="T1:U797">1</span> + <span class="mxinfo " id="T1:U798">sin(<span class="var type1" id="S6T1U1067">psi</span>)</span></span> ) ./ ( <span class="mxinfo " id="T1:U800"><span class="mxinfo " id="T1:U801">1</span> - <span class="mxinfo " id="T1:U802">sin(<span class="var type1" id="S6T1U1073">psi</span>)</span></span> )</span> )</span></span></span> - <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line">                    <span class="mxinfo " id="T1:U804"><span class="mxinfo " id="T1:U805"><span class="mxinfo " id="T1:U806"><span class="mxinfo " id="T1:U807">2</span> * ( <span class="mxinfo " id="T1:U808"><span class="var type1" id="S53T1U1080">E</span> - <span class="mxinfo " id="T1:U810">( <span class="mxinfo " id="T1:U811"><span class="mxinfo " id="T1:U812">1</span> - <span class="var type1" id="S39T1U1085">nn</span></span> ) * <span class="var type1" id="S54T1U1086">Pi</span></span></span> )</span> .* <span class="mxinfo " id="T1:U815"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U816"><span class="var type1" id="S17T1U1090">K2</span> * ( <span class="mxinfo " id="T1:U818"><span class="mxinfo " id="T1:U819">1</span> - <span class="var type1" id="S13T1U1094">ee</span></span> )</span> )</span></span></span> / <span class="mxinfo " id="T1:U821"><span class="potentialdiff PD1"><span class="var type1" id="S16T1U1096">K1</span> ^ ( 3/2 )</span></span></span></span> )</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line">        <span class="keyword">elseif</span>  <span class="mxinfo " id="T2:U823"><span class="var type1" id="S17T1U1103">K2</span> &gt; <span class="mxinfo " id="T1:U825"><span class="mxinfo " id="T1:U826">2</span> * ( <span class="mxinfo " id="T1:U827"><span class="mxinfo " id="T1:U828">1</span> - <span class="var type1" id="S13T1U1109">ee</span></span> )</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line">            <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line">            <span class="comment">% Type II Hiperbolic Spiral</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line">            <span class="comment">% There is a transition between raising and lowering regime [rmin]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line">            <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,213" id="srcline213">213</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,214" id="srcline214">214</a></span><span class="line">            <span class="comment">% Minimum Radius</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,215" id="srcline215">215</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,216" id="srcline216">216</a></span><span class="line">            <span class="mxinfo " id="T1:U830"><span class="var type1" id="S60T1U1112">rmin</span> = <span class="mxinfo " id="T1:U832">( <span class="mxinfo " id="T1:U833"><span class="var type1" id="S17T1U1116">K2</span> - <span class="mxinfo " id="T1:U835"><span class="mxinfo " id="T1:U836">2</span> * ( <span class="mxinfo " id="T1:U837"><span class="mxinfo " id="T1:U838">1</span> - <span class="var type1" id="S13T1U1122">ee</span></span> )</span></span> ) / ( <span class="var type1" id="S16T1U1124">K1</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,217" id="srcline217">217</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,218" id="srcline218">218</a></span><span class="line">            <span class="mxinfo " id="T1:U841"><span class="var type1" id="S24T1U1127">ell</span>  = <span class="mxinfo " id="T1:U843"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U844"><span class="mxinfo " id="T1:U845"><span class="potentialdiff PD1"><span class="var type1" id="S17T1U1132">K2</span>^2</span></span> - <span class="mxinfo " id="T1:U847"><span class="mxinfo " id="T1:U848">4</span> * <span class="mxinfo " id="T1:U849"><span class="potentialdiff PD1">( <span class="mxinfo " id="T1:U850"><span class="mxinfo " id="T1:U851">1</span> - <span class="var type1" id="S13T1U1140">ee</span></span> )^2</span></span></span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,219" id="srcline219">219</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,220" id="srcline220">220</a></span><span class="line">            <span class="mxinfo " id="T1:U853"><span class="var type1" id="S26T1U1144">thetam</span>   = <span class="mxinfo " id="T1:U855"><span class="var type1" id="S10T1U1146">theta0</span> - <span class="mxinfo " id="T1:U857"><span class="mxinfo " id="T1:U858"><span class="mxinfo " id="T1:U859"><span class="var type1" id="S20T1U1150">regime0</span> * <span class="var type1" id="S17T1U1151">K2</span></span> / <span class="var type1" id="S24T1U1152">ell</span></span> * ( <span class="mxinfo " id="T1:U863"><span class="mxinfo " id="T1:U864"><span class="mxinfo " id="T1:U865">pi</span> / <span class="mxinfo " id="T1:U866">2</span></span> + <span class="mxinfo " id="T1:U867">atan ( <span class="mxinfo " id="T1:U868">( <span class="mxinfo " id="T1:U869"><span class="mxinfo " id="T1:U870"><span class="mxinfo " id="T1:U871">2</span> * ( <span class="mxinfo " id="T1:U872"><span class="mxinfo " id="T1:U873">1</span> - <span class="var type1" id="S13T1U1169">ee</span></span> )</span> - <span class="mxinfo " id="T1:U875"><span class="var type1" id="S17T1U1171">K2</span> * <span class="mxinfo " id="T1:U877">sin(<span class="var type1" id="S11T1U1174">psi0</span>)</span></span></span> ) / <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,221" id="srcline221">221</a></span><span class="line">                (<span class="mxinfo " id="T1:U879"><span class="var type1" id="S24T1U1177">ell</span> * <span class="mxinfo " id="T1:U881">abs ( <span class="mxinfo " id="T1:U882">cos(<span class="var type1" id="S11T1U1182">psi0</span>)</span> )</span></span> )</span> )</span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,222" id="srcline222">222</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,223" id="srcline223">223</a></span><span class="line">            <span class="comment">% Get the position of the Asymptotes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,224" id="srcline224">224</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,225" id="srcline225">225</a></span><span class="line">            <span class="mxinfo " id="T1:U884"><span class="var type1" id="S63T1U1185">thetaAs1</span> = <span class="mxinfo " id="T1:U886"><span class="var type1" id="S26T1U1187">thetam</span> +  <span class="mxinfo " id="T1:U888"><span class="mxinfo " id="T1:U889"><span class="var type1" id="S17T1U1190">K2</span> / <span class="var type1" id="S24T1U1191">ell</span></span> * ( <span class="mxinfo " id="T1:U892"><span class="mxinfo " id="T1:U893"><span class="mxinfo " id="T1:U894">pi</span> / <span class="mxinfo " id="T1:U895">2</span></span> + <span class="mxinfo " id="T1:U896">atan ( <span class="mxinfo " id="T1:U897"><span class="mxinfo " id="T1:U898"><span class="mxinfo " id="T1:U899">2</span> * ( <span class="mxinfo " id="T1:U900"><span class="mxinfo " id="T1:U901">1</span> - <span class="var type1" id="S13T1U1206">ee</span></span> )</span> / ( <span class="var type1" id="S24T1U1208">ell</span> )</span> )</span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,226" id="srcline226">226</a></span><span class="line">            <span class="mxinfo " id="T1:U904"><span class="var type1" id="S64T1U1211">thetaAs2</span> = <span class="mxinfo " id="T1:U906"><span class="var type1" id="S26T1U1213">thetam</span> -  <span class="mxinfo " id="T1:U908"><span class="mxinfo " id="T1:U909"><span class="var type1" id="S17T1U1216">K2</span> / <span class="var type1" id="S24T1U1217">ell</span></span> * ( <span class="mxinfo " id="T1:U912"><span class="mxinfo " id="T1:U913"><span class="mxinfo " id="T1:U914">pi</span> / <span class="mxinfo " id="T1:U915">2</span></span> + <span class="mxinfo " id="T1:U916">atan ( <span class="mxinfo " id="T1:U917"><span class="mxinfo " id="T1:U918"><span class="mxinfo " id="T1:U919">2</span> * ( <span class="mxinfo " id="T1:U920"><span class="mxinfo " id="T1:U921">1</span> - <span class="var type1" id="S13T1U1232">ee</span></span> )</span> / ( <span class="var type1" id="S24T1U1234">ell</span> )</span> )</span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,227" id="srcline227">227</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,228" id="srcline228">228</a></span><span class="line">            <span class="comment">% Check that the desired theta is lower than Asymtote</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,229" id="srcline229">229</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,230" id="srcline230">230</a></span><span class="line">            <span class="mxinfo " id="T2:U924"><span class="keyword">if</span> (( <span class="mxinfo " id="T2:U925"><span class="var type1" id="S12T1U1242">thetaf</span> &gt; <span class="var type1" id="S63T1U1243">thetaAs1</span></span>) &amp;&amp; (<span class="mxinfo " id="T2:U928"><span class="var type1" id="S63T1U1246">thetaAs1</span>&gt;<span class="var type1" id="S10T1U1247">theta0</span></span>) )|| (( <span class="mxinfo " id="T2:U931"><span class="var type1" id="S12T1U1252">thetaf</span> &gt; <span class="var type1" id="S64T1U1253">thetaAs2</span></span>) &amp;&amp; (<span class="mxinfo " id="T2:U934"><span class="var type1" id="S64T1U1256">thetaAs2</span>&gt;<span class="var type1" id="S10T1U1257">theta0</span></span>) )</span></span>
<span class="srcline"><span class="lineno"><a href="1,231" id="srcline231">231</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,232" id="srcline232">232</a></span><span class="line">                <span class="mxinfo " id="T1:U937"><span class="var type1" id="S7T1U1260">flag</span> = <span class="mxinfo " id="T1:U939">-<span class="mxinfo " id="T1:U940">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,233" id="srcline233">233</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,234" id="srcline234">234</a></span><span class="line">            <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,235" id="srcline235">235</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,236" id="srcline236">236</a></span><span class="line">            <span class="mxinfo " id="T1:U941"><span class="var type1" id="S30T1U1265">beta</span> = <span class="mxinfo " id="T1:U943"><span class="mxinfo " id="T1:U944"><span class="var type1" id="S24T1U1268">ell</span> / <span class="var type1" id="S17T1U1269">K2</span></span> * ( <span class="mxinfo " id="T1:U947"><span class="var type1" id="S5T1U1272">theta</span> - <span class="var type1" id="S26T1U1273">thetam</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,237" id="srcline237">237</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,238" id="srcline238">238</a></span><span class="line">            <span class="mxinfo " id="T1:U950"><span class="var type1" id="S4T1U1276">r</span>   = <span class="mxinfo " id="T1:U952"><span class="var type1" id="S60T1U1278">rmin</span> * ( <span class="mxinfo " id="T1:U954">( <span class="mxinfo " id="T1:U955"><span class="mxinfo " id="T1:U956"><span class="mxinfo " id="T1:U957">2</span> * ( <span class="mxinfo " id="T1:U958"><span class="mxinfo " id="T1:U959">1</span> - <span class="var type1" id="S13T1U1288">ee</span></span> )</span> + <span class="var type1" id="S17T1U1289">K2</span></span> ) ./ ( <span class="mxinfo " id="T1:U962"><span class="mxinfo " id="T1:U963"><span class="mxinfo " id="T1:U964">2</span> * ( <span class="mxinfo " id="T1:U965"><span class="mxinfo " id="T1:U966">1</span> - <span class="var type1" id="S13T1U1297">ee</span></span> )</span> + <span class="mxinfo " id="T1:U968"><span class="var type1" id="S17T1U1299">K2</span> * <span class="mxinfo " id="T1:U970">cos(<span class="var type1" id="S30T1U1302">beta</span>)</span></span></span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,239" id="srcline239">239</a></span><span class="line">            <span class="mxinfo " id="T1:U972"><span class="var type1" id="S3T1U1305">v</span>   = <span class="mxinfo " id="T1:U974"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U975"><span class="var type1" id="S16T1U1309">K1</span> + <span class="mxinfo " id="T1:U977"><span class="mxinfo " id="T1:U978"><span class="mxinfo " id="T1:U979">2</span> ./ <span class="var type1" id="S4T1U1313">r</span></span> * ( <span class="mxinfo " id="T1:U981"><span class="mxinfo " id="T1:U982">1</span> - <span class="var type1" id="S13T1U1317">ee</span></span> )</span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,240" id="srcline240">240</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,241" id="srcline241">241</a></span><span class="line">            <span class="mxinfo " id="T1:U984"><span class="var type1" id="S29T1U1320">regime</span>  = <span class="mxinfo " id="T1:U986"><span class="mxinfo " id="T1:U987">-1 * (<span class="mxinfo " id="T2:U988"><span class="var type1" id="S5T1U1327">theta</span> &lt; <span class="var type1" id="S26T1U1328">thetam</span></span>)</span> + <span class="mxinfo " id="T1:U991">1 * (<span class="mxinfo " id="T2:U992"><span class="var type1" id="S5T1U1333">theta</span> &gt;= <span class="var type1" id="S26T1U1334">thetam</span></span>)</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,242" id="srcline242">242</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,243" id="srcline243">243</a></span><span class="line">            <span class="mxinfo " id="T1:U995"><span class="var type1" id="S32T1U1337">cpsi</span>   = <span class="mxinfo " id="T1:U997"><span class="var type1" id="S29T1U1339">regime</span> .* ( <span class="mxinfo " id="T1:U999"><span class="mxinfo " id="T1:U1000"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U1001"><span class="mxinfo " id="T1:U1002"><span class="potentialdiff PD1">( <span class="mxinfo " id="T1:U1003"><span class="mxinfo " id="T1:U1004"><span class="mxinfo " id="T1:U1005">2</span> * ( <span class="mxinfo " id="T1:U1006"><span class="mxinfo " id="T1:U1007">1</span> - <span class="var type1" id="S13T1U1353">ee</span></span> )</span> +  <span class="mxinfo " id="T1:U1009"><span class="var type1" id="S16T1U1355">K1</span> * <span class="var type1" id="S4T1U1356">r</span></span></span> ).^2</span></span> - <span class="mxinfo " id="T1:U1012"><span class="potentialdiff PD1"><span class="var type1" id="S17T1U1359">K2</span>^2</span></span></span> )</span></span> ./ ( <span class="mxinfo " id="T1:U1014"><span class="mxinfo " id="T1:U1015"><span class="mxinfo " id="T1:U1016">2</span> * ( <span class="mxinfo " id="T1:U1017"><span class="mxinfo " id="T1:U1018">1</span> - <span class="var type1" id="S13T1U1368">ee</span></span> )</span> + <span class="mxinfo " id="T1:U1020"><span class="var type1" id="S16T1U1370">K1</span> * <span class="var type1" id="S4T1U1371">r</span></span></span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,244" id="srcline244">244</a></span><span class="line">            <span class="mxinfo " id="T1:U1023"><span class="var type1" id="S33T1U1374">spsi</span>   = <span class="mxinfo " id="T1:U1025"><span class="var type1" id="S17T1U1376">K2</span> ./ ( <span class="mxinfo " id="T1:U1027"><span class="mxinfo " id="T1:U1028"><span class="mxinfo " id="T1:U1029">2</span> * ( <span class="mxinfo " id="T1:U1030"><span class="mxinfo " id="T1:U1031">1</span> - <span class="var type1" id="S13T1U1384">ee</span></span> )</span> + <span class="mxinfo " id="T1:U1033"><span class="var type1" id="S16T1U1386">K1</span> * <span class="var type1" id="S4T1U1387">r</span></span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,245" id="srcline245">245</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,246" id="srcline246">246</a></span><span class="line">            <span class="mxinfo " id="T1:U1036"><span class="var type1" id="S6T1U1390">psi</span>    =  <span class="mxinfo " id="T1:U1038">atan2( real(<span class="var type1" id="S33T1U1395">spsi</span>) , real(<span class="var type1" id="S32T1U1398">cpsi</span>) )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,247" id="srcline247">247</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,248" id="srcline248">248</a></span><span class="line">            <span class="comment">% Time of Flight</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,249" id="srcline249">249</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,250" id="srcline250">250</a></span><span class="line">            <span class="mxinfo " id="T1:U1041"><span class="var type1" id="S37T1U1401">kk</span>      =  <span class="mxinfo " id="T1:U1043"><span class="mxinfo " id="T1:U1044"><span class="mxinfo " id="T1:U1045">2</span> * <span class="mxinfo " id="T1:U1046"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U1047"><span class="mxinfo " id="T1:U1048">1</span> - <span class="var type1" id="S13T1U1409">ee</span></span> )</span></span></span> / <span class="mxinfo " id="T1:U1050"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U1051"><span class="var type1" id="S17T1U1413">K2</span> + <span class="mxinfo " id="T1:U1053"><span class="mxinfo " id="T1:U1054">2</span> * ( <span class="mxinfo " id="T1:U1055"><span class="mxinfo " id="T1:U1056">1</span> - <span class="var type1" id="S13T1U1419">ee</span></span> )</span></span> )</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,251" id="srcline251">251</a></span><span class="line">            <span class="mxinfo " id="T1:U1058"><span class="var type1" id="S39T1U1422">nn</span>      =  <span class="mxinfo " id="T1:U1060"><span class="mxinfo " id="T1:U1061"><span class="mxinfo " id="T1:U1062">2</span> * ( <span class="mxinfo " id="T1:U1063"><span class="mxinfo " id="T1:U1064">1</span> - <span class="var type1" id="S13T1U1429">ee</span></span> )</span> / <span class="var type1" id="S17T1U1430">K2</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,252" id="srcline252">252</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,253" id="srcline253">253</a></span><span class="line">            <span class="comment">% Ellliptic integrals</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,254" id="srcline254">254</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,255" id="srcline255">255</a></span><span class="line">            <span class="mxinfo " id="T1:U1067"><span class="var type1" id="S40T1U1433">phi0</span>    = real(<span class="mxinfo " id="T1:U1069"><span class="potentialdiff PD1">asin ( <span class="mxinfo " id="T1:U1070"><span class="mxinfo " id="T1:U1071"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U1072"><span class="mxinfo " id="T1:U1073"><span class="mxinfo " id="T1:U1074">2</span> * ( <span class="mxinfo " id="T1:U1075"><span class="mxinfo " id="T1:U1076">1</span> - <span class="var type1" id="S13T1U1447">ee</span></span> )</span> * ( <span class="mxinfo " id="T1:U1078"><span class="mxinfo " id="T1:U1079">1</span> - <span class="mxinfo " id="T1:U1080">sin (<span class="var type1" id="S11T1U1453">psi0</span>)</span></span> )</span>)</span></span> / ( <span class="mxinfo " id="T1:U1082"><span class="var type1" id="S37T1U1456">kk</span> * <span class="mxinfo " id="T1:U1084"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U1085"><span class="var type1" id="S17T1U1460">K2</span> - <span class="mxinfo " id="T1:U1087"><span class="mxinfo " id="T1:U1088"><span class="mxinfo " id="T1:U1089">2</span> * ( <span class="mxinfo " id="T1:U1090"><span class="mxinfo " id="T1:U1091">1</span> - <span class="var type1" id="S13T1U1467">ee</span></span> )</span> * <span class="mxinfo " id="T1:U1093">sin(<span class="var type1" id="S11T1U1470">psi0</span>)</span></span></span> )</span></span></span> )</span> )</span></span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,256" id="srcline256">256</a></span><span class="line">            <span class="mxinfo " id="T1:U1095"><span class="var type1" id="S50T1U1473">phi</span>    =  real(<span class="mxinfo " id="T1:U1097"><span class="potentialdiff PD1">asin ( <span class="mxinfo " id="T1:U1098"><span class="mxinfo " id="T1:U1099"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U1100"><span class="mxinfo " id="T1:U1101"><span class="mxinfo " id="T1:U1102">2</span> * ( <span class="mxinfo " id="T1:U1103"><span class="mxinfo " id="T1:U1104">1</span> - <span class="var type1" id="S13T1U1487">ee</span></span> )</span> * ( <span class="mxinfo " id="T1:U1106"><span class="mxinfo " id="T1:U1107">1</span> - <span class="mxinfo " id="T1:U1108">sin (<span class="var type1" id="S6T1U1493">psi</span>)</span></span> )</span>)</span></span> ./ ( <span class="mxinfo " id="T1:U1110"><span class="var type1" id="S37T1U1496">kk</span> * <span class="mxinfo " id="T1:U1112"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U1113"><span class="var type1" id="S17T1U1500">K2</span> - <span class="mxinfo " id="T1:U1115"><span class="mxinfo " id="T1:U1116"><span class="mxinfo " id="T1:U1117">2</span> * ( <span class="mxinfo " id="T1:U1118"><span class="mxinfo " id="T1:U1119">1</span> - <span class="var type1" id="S13T1U1507">ee</span></span> )</span> * <span class="mxinfo " id="T1:U1121">sin(<span class="var type1" id="S6T1U1510">psi</span>)</span></span></span> )</span></span></span> )</span> )</span></span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,257" id="srcline257">257</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,258" id="srcline258">258</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T2:U1123"><span class="var type1" id="S7T1U1514">flag</span> == <span class="mxinfo " id="T1:U1125">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,259" id="srcline259">259</a></span><span class="line">                <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,260" id="srcline260">260</a></span><span class="line">                [<span class="var type1" id="S65T1U1519">F0</span>,<span class="var type1" id="S48T1U1520">E0</span>] = <span class="fcn" id="F106N3:B1522">ELIT</span>(<span class="var type1" id="S37T1U1523">kk</span>,<span class="mxinfo " id="T1:U1129"><span class="mxinfo " id="T1:U1130"><span class="var type1" id="S40T1U1526">phi0</span>*<span class="mxinfo " id="T1:U1132">180</span></span>/<span class="var type1" id="S14T1U1528">PI</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,261" id="srcline261">261</a></span><span class="line">                <span class="mxinfo " id="T1:U1134"><span class="var type1" id="S49T1U1531">Pi0</span>    = <span class="mxinfo " id="T1:U1136"><span class="fcn" id="F107N4:B1533">ELIT3</span>(<span class="mxinfo " id="T1:U1137"><span class="mxinfo " id="T1:U1138"><span class="var type1" id="S40T1U1536">phi0</span>*<span class="mxinfo " id="T1:U1140">180</span></span>/<span class="var type1" id="S14T1U1538">PI</span></span>,<span class="var type1" id="S37T1U1539">kk</span>,<span class="var type1" id="S39T1U1540">nn</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,262" id="srcline262">262</a></span><span class="line">                <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,263" id="srcline263">263</a></span><span class="line">                [<span class="var type1" id="S66T1U1544">F</span>,<span class="var type1" id="S53T1U1545">E</span>] = <span class="fcn" id="F106N3:B1547">ELIT</span>(<span class="var type1" id="S37T1U1548">kk</span>,<span class="mxinfo " id="T1:U1147"><span class="mxinfo " id="T1:U1148"><span class="var type1" id="S50T1U1551">phi</span>*<span class="mxinfo " id="T1:U1150">180</span></span>/<span class="var type1" id="S14T1U1553">PI</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,264" id="srcline264">264</a></span><span class="line">                <span class="mxinfo " id="T1:U1152"><span class="var type1" id="S54T1U1556">Pi</span>    = <span class="mxinfo " id="T1:U1154"><span class="fcn" id="F107N4:B1558">ELIT3</span>(<span class="mxinfo " id="T1:U1155"><span class="mxinfo " id="T1:U1156"><span class="var type1" id="S50T1U1561">phi</span>*<span class="mxinfo " id="T1:U1158">180</span></span>/<span class="var type1" id="S14T1U1563">PI</span></span>,<span class="var type1" id="S37T1U1564">kk</span>,<span class="var type1" id="S39T1U1565">nn</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,265" id="srcline265">265</a></span><span class="line">                <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,266" id="srcline266">266</a></span><span class="line">                <span class="mxinfo " id="T1:U1162"><span class="var type1" id="S55T1U1568">K4</span>      = <span class="mxinfo " id="T1:U1164"><span class="mxinfo " id="T1:U1165">+ <span class="var type1" id="S20T1U1571">regime0</span></span> * ( <span class="mxinfo " id="T1:U1167"><span class="mxinfo " id="T1:U1168"><span class="mxinfo " id="T1:U1169">( <span class="mxinfo " id="T1:U1170"><span class="mxinfo " id="T1:U1171"><span class="mxinfo " id="T1:U1172">( <span class="mxinfo " id="T1:U1173"><span class="var type1" id="S17T1U1582">K2</span> + <span class="mxinfo " id="T1:U1175"><span class="mxinfo " id="T1:U1176">2</span> * (<span class="mxinfo " id="T1:U1177"><span class="mxinfo " id="T1:U1178">1</span> - <span class="var type1" id="S13T1U1588">ee</span></span>)</span></span> ) * <span class="var type1" id="S17T1U1589">K2</span></span> * <span class="var type1" id="S48T1U1590">E0</span></span> - <span class="mxinfo " id="T1:U1182"><span class="mxinfo " id="T1:U1183"><span class="var type1" id="S16T1U1593">K1</span> * <span class="var type1" id="S60T1U1594">rmin</span></span> * ( <span class="mxinfo " id="T1:U1186"><span class="mxinfo " id="T1:U1187"><span class="var type1" id="S17T1U1598">K2</span> * <span class="var type1" id="S65T1U1599">F0</span></span> + <span class="mxinfo " id="T1:U1190"><span class="mxinfo " id="T1:U1191"><span class="mxinfo " id="T1:U1192">2</span> * ( <span class="mxinfo " id="T1:U1193"><span class="mxinfo " id="T1:U1194">1</span> - <span class="var type1" id="S13T1U1606">ee</span></span> )</span> * <span class="var type1" id="S49T1U1607">Pi0</span></span></span> )</span></span>) / <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,267" id="srcline267">267</a></span><span class="line">                    ( <span class="mxinfo " id="T1:U1197"><span class="var type1" id="S16T1U1610">K1</span> * <span class="mxinfo " id="T1:U1199"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U1200"><span class="mxinfo " id="T1:U1201"><span class="var type1" id="S16T1U1615">K1</span> * <span class="var type1" id="S17T1U1616">K2</span></span> * ( <span class="mxinfo " id="T1:U1204"><span class="var type1" id="S17T1U1619">K2</span> + <span class="mxinfo " id="T1:U1206"><span class="mxinfo " id="T1:U1207">2</span> * ( <span class="mxinfo " id="T1:U1208"><span class="mxinfo " id="T1:U1209">1</span> - <span class="var type1" id="S13T1U1625">ee</span></span> )</span></span> )</span> )</span></span></span> )</span> + <span class="mxinfo " id="T1:U1211"><span class="mxinfo " id="T1:U1212"><span class="mxinfo " id="T1:U1213"><span class="mxinfo " id="T1:U1214">2</span> * ( <span class="mxinfo " id="T1:U1215"><span class="mxinfo " id="T1:U1216">1</span> - <span class="var type1" id="S13T1U1633">ee</span></span> )</span> / ( <span class="mxinfo " id="T1:U1218"><span class="potentialdiff PD1"><span class="var type1" id="S16T1U1636">K1</span>^( 3/2 )</span></span>)</span> * <span class="mxinfo " id="T1:U1220">asinh( <span class="mxinfo " id="T1:U1221"><span class="mxinfo " id="T1:U1222"><span class="potentialdiff PD1">sqrt( <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,268" id="srcline268">268</a></span><span class="line">                    <span class="mxinfo " id="T1:U1223"><span class="mxinfo " id="T1:U1224"><span class="mxinfo " id="T1:U1225"><span class="mxinfo " id="T1:U1226">2</span> * <span class="var type1" id="S16T1U1650">K1</span></span> * <span class="var type1" id="S9T1U1651">r0</span></span> * ( <span class="mxinfo " id="T1:U1229"><span class="mxinfo " id="T1:U1230"><span class="var type1" id="S9T1U1655">r0</span> * <span class="mxinfo " id="T1:U1232"><span class="potentialdiff PD1"><span class="var type1" id="S8T1U1657">v0</span> ^2</span></span></span> - <span class="var type1" id="S17T1U1659">K2</span></span> )</span>)</span></span> / ( <span class="mxinfo " id="T1:U1235"><span class="mxinfo " id="T1:U1236">2</span> * <span class="mxinfo " id="T1:U1237"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U1238"><span class="mxinfo " id="T1:U1239"><span class="mxinfo " id="T1:U1240"><span class="var type1" id="S17T1U1668">K2</span> * <span class="var type1" id="S9T1U1669">r0</span></span> * <span class="mxinfo " id="T1:U1243"><span class="potentialdiff PD1"><span class="var type1" id="S8T1U1671">v0</span>^2</span></span></span> + <span class="mxinfo " id="T1:U1245">( <span class="mxinfo " id="T1:U1246"><span class="mxinfo " id="T1:U1247"><span class="var type1" id="S9T1U1677">r0</span> * <span class="mxinfo " id="T1:U1249"><span class="potentialdiff PD1"><span class="var type1" id="S8T1U1679">v0</span>^2</span></span></span> - <span class="var type1" id="S17T1U1681">K2</span></span> ) * ( <span class="mxinfo " id="T1:U1252"><span class="mxinfo " id="T1:U1253">1</span> - <span class="var type1" id="S13T1U1685">ee</span></span> )</span></span> )</span></span></span> )</span> )</span></span></span> +<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,269" id="srcline269">269</a></span><span class="line">                    <span class="mxinfo " id="T1:U1255"><span class="mxinfo " id="T1:U1256"><span class="mxinfo " id="T1:U1257">- <span class="var type1" id="S8T1U1689">v0</span></span> / <span class="mxinfo " id="T1:U1259"><span class="potentialdiff PD1"><span class="var type1" id="S16T1U1691">K1</span>^2</span></span></span> * <span class="mxinfo " id="T1:U1261"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U1262"><span class="mxinfo " id="T1:U1263"><span class="mxinfo " id="T1:U1264"><span class="potentialdiff PD1"><span class="var type1" id="S9T1U1698">r0</span>^2</span></span> * <span class="mxinfo " id="T1:U1266"><span class="potentialdiff PD1"><span class="var type1" id="S8T1U1701">v0</span>^4</span></span></span> - <span class="mxinfo " id="T1:U1268"><span class="potentialdiff PD1"><span class="var type1" id="S17T1U1704">K2</span> ^2</span></span></span> )</span></span></span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,270" id="srcline270">270</a></span><span class="line">                <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,271" id="srcline271">271</a></span><span class="line">                <span class="mxinfo " id="T1:U1270"><span class="var type1" id="S2T1U1708">Time</span>    = <span class="mxinfo " id="T1:U1272"><span class="var type1" id="S55T1U1710">K4</span> - <span class="mxinfo " id="T1:U1274"><span class="var type1" id="S29T1U1712">regime</span> .* ( <span class="mxinfo " id="T1:U1276"><span class="mxinfo " id="T1:U1277"><span class="mxinfo " id="T1:U1278">( <span class="mxinfo " id="T1:U1279"><span class="mxinfo " id="T1:U1280"><span class="mxinfo " id="T1:U1281">( <span class="mxinfo " id="T1:U1282"><span class="var type1" id="S17T1U1723">K2</span> + <span class="mxinfo " id="T1:U1284"><span class="mxinfo " id="T1:U1285">2</span> .* (<span class="mxinfo " id="T1:U1286"><span class="mxinfo " id="T1:U1287">1</span> - <span class="var type1" id="S13T1U1729">ee</span></span>)</span></span> ) .* <span class="var type1" id="S17T1U1730">K2</span></span> .* <span class="var type1" id="S53T1U1731">E</span></span> - <span class="mxinfo " id="T1:U1291"><span class="mxinfo " id="T1:U1292"><span class="var type1" id="S16T1U1734">K1</span> .* <span class="var type1" id="S60T1U1735">rmin</span></span> .* ( <span class="mxinfo " id="T1:U1295"><span class="mxinfo " id="T1:U1296"><span class="var type1" id="S17T1U1739">K2</span> .* <span class="var type1" id="S66T1U1740">F</span></span> + <span class="mxinfo " id="T1:U1299"><span class="mxinfo " id="T1:U1300"><span class="mxinfo " id="T1:U1301">2</span> .* ( <span class="mxinfo " id="T1:U1302"><span class="mxinfo " id="T1:U1303">1</span> - <span class="var type1" id="S13T1U1747">ee</span></span> )</span> .* <span class="var type1" id="S54T1U1748">Pi</span></span></span> )</span></span>) ./ <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,272" id="srcline272">272</a></span><span class="line">                    ( <span class="mxinfo " id="T1:U1306"><span class="var type1" id="S16T1U1751">K1</span> .* <span class="mxinfo " id="T1:U1308"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U1309"><span class="mxinfo " id="T1:U1310"><span class="var type1" id="S16T1U1756">K1</span> .* <span class="var type1" id="S17T1U1757">K2</span></span> .* ( <span class="mxinfo " id="T1:U1313"><span class="var type1" id="S17T1U1760">K2</span> + <span class="mxinfo " id="T1:U1315"><span class="mxinfo " id="T1:U1316">2</span> .* ( <span class="mxinfo " id="T1:U1317"><span class="mxinfo " id="T1:U1318">1</span> - <span class="var type1" id="S13T1U1766">ee</span></span> )</span></span> )</span> )</span></span></span> )</span> + <span class="mxinfo " id="T1:U1320"><span class="mxinfo " id="T1:U1321"><span class="mxinfo " id="T1:U1322"><span class="mxinfo " id="T1:U1323">2</span> .* ( <span class="mxinfo " id="T1:U1324"><span class="mxinfo " id="T1:U1325">1</span> - <span class="var type1" id="S13T1U1774">ee</span></span> )</span> / ( <span class="mxinfo " id="T1:U1327"><span class="potentialdiff PD1"><span class="var type1" id="S16T1U1777">K1</span>^( 3/2 )</span></span>)</span> .* <span class="mxinfo " id="T1:U1329">asinh( <span class="mxinfo " id="T1:U1330"><span class="mxinfo " id="T1:U1331"><span class="potentialdiff PD1">sqrt( <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,273" id="srcline273">273</a></span><span class="line">                    <span class="mxinfo " id="T1:U1332"><span class="mxinfo " id="T1:U1333"><span class="mxinfo " id="T1:U1334"><span class="mxinfo " id="T1:U1335">2</span> .* <span class="var type1" id="S16T1U1791">K1</span></span> .* <span class="var type1" id="S4T1U1792">r</span></span> .* ( <span class="mxinfo " id="T1:U1338"><span class="mxinfo " id="T1:U1339"><span class="var type1" id="S4T1U1796">r</span> .* <span class="mxinfo " id="T1:U1341"><span class="potentialdiff PD1"><span class="var type1" id="S3T1U1798">v</span>.^2</span></span></span> - <span class="var type1" id="S17T1U1800">K2</span></span> )</span>)</span></span> ./ ( <span class="mxinfo " id="T1:U1344"><span class="mxinfo " id="T1:U1345">2</span> .* <span class="mxinfo " id="T1:U1346"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U1347"><span class="mxinfo " id="T1:U1348"><span class="mxinfo " id="T1:U1349"><span class="var type1" id="S17T1U1809">K2</span> .* <span class="var type1" id="S4T1U1810">r</span></span> .* <span class="mxinfo " id="T1:U1352"><span class="potentialdiff PD1"><span class="var type1" id="S3T1U1812">v</span>.^2</span></span></span> + <span class="mxinfo " id="T1:U1354">( <span class="mxinfo " id="T1:U1355"><span class="mxinfo " id="T1:U1356"><span class="var type1" id="S4T1U1818">r</span> .* <span class="mxinfo " id="T1:U1358"><span class="potentialdiff PD1"><span class="var type1" id="S3T1U1820">v</span>.^2</span></span></span> - <span class="var type1" id="S17T1U1822">K2</span></span> ) .* ( <span class="mxinfo " id="T1:U1361"><span class="mxinfo " id="T1:U1362">1</span> - <span class="var type1" id="S13T1U1826">ee</span></span> )</span></span> )</span></span></span> )</span> )</span></span></span> +<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,274" id="srcline274">274</a></span><span class="line">                    <span class="mxinfo " id="T1:U1364"><span class="mxinfo " id="T1:U1365"><span class="mxinfo " id="T1:U1366">- <span class="var type1" id="S3T1U1830">v</span></span> ./ <span class="mxinfo " id="T1:U1368"><span class="potentialdiff PD1"><span class="var type1" id="S16T1U1832">K1</span>^2</span></span></span> .* <span class="mxinfo " id="T1:U1370"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U1371"><span class="mxinfo " id="T1:U1372"><span class="mxinfo " id="T1:U1373"><span class="potentialdiff PD1"><span class="var type1" id="S4T1U1839">r</span>.^2</span></span> .* <span class="mxinfo " id="T1:U1375"><span class="potentialdiff PD1"><span class="var type1" id="S3T1U1842">v</span>.^4</span></span></span> - <span class="mxinfo " id="T1:U1377"><span class="potentialdiff PD1"><span class="var type1" id="S17T1U1845">K2</span>^2</span></span></span> )</span></span></span></span> )</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,275" id="srcline275">275</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,276" id="srcline276">276</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,277" id="srcline277">277</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,278" id="srcline278">278</a></span><span class="line">            <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,279" id="srcline279">279</a></span><span class="line">            <span class="comment">% Limit case Hiperbolyc spiral</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,280" id="srcline280">280</a></span><span class="line">            <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,281" id="srcline281">281</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,282" id="srcline282">282</a></span><span class="line">            <span class="comment">% Get the asymptote</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,283" id="srcline283">283</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,284" id="srcline284">284</a></span><span class="line">            <span class="mxinfo " id="T1:U1379"><span class="var type1" id="S57T1U1850">thetaAs</span>  = <span class="mxinfo " id="T1:U1381"><span class="var type1" id="S10T1U1852">theta0</span> - <span class="mxinfo " id="T1:U1383"><span class="var type1" id="S20T1U1854">regime0</span> * ( <span class="mxinfo " id="T1:U1385"><span class="mxinfo " id="T1:U1386">1</span> - <span class="mxinfo " id="T1:U1387"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U1388"><span class="mxinfo " id="T1:U1389">1</span> + <span class="mxinfo " id="T1:U1390"><span class="mxinfo " id="T1:U1391"><span class="mxinfo " id="T1:U1392">4</span> * ( <span class="mxinfo " id="T1:U1393"><span class="mxinfo " id="T1:U1394">1</span> - <span class="var type1" id="S13T1U1868">ee</span></span> )</span> / ( <span class="mxinfo " id="T1:U1396"><span class="var type1" id="S16T1U1871">K1</span> * <span class="var type1" id="S9T1U1872">r0</span></span> )</span></span> )</span></span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,285" id="srcline285">285</a></span><span class="line">            <span class="mxinfo " id="T1:U1399"><span class="var type1" id="S30T1U1875">beta</span>     = <span class="mxinfo " id="T1:U1401"><span class="var type1" id="S5T1U1877">theta</span> - <span class="var type1" id="S57T1U1878">thetaAs</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,286" id="srcline286">286</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,287" id="srcline287">287</a></span><span class="line">            <span class="mxinfo " id="T1:U1404"><span class="var type1" id="S4T1U1881">r</span>       = <span class="mxinfo " id="T1:U1406"><span class="mxinfo " id="T1:U1407"><span class="mxinfo " id="T1:U1408">4</span> * ( <span class="mxinfo " id="T1:U1409"><span class="mxinfo " id="T1:U1410">1</span> - <span class="var type1" id="S13T1U1888">ee</span></span> )</span>./ ( <span class="mxinfo " id="T1:U1412"><span class="mxinfo " id="T1:U1413"><span class="var type1" id="S16T1U1892">K1</span> * <span class="var type1" id="S30T1U1893">beta</span></span> .* ( <span class="mxinfo " id="T1:U1416"><span class="var type1" id="S30T1U1896">beta</span> - <span class="mxinfo " id="T1:U1418"><span class="var type1" id="S20T1U1898">regime0</span> * <span class="mxinfo " id="T1:U1420">2</span></span></span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,288" id="srcline288">288</a></span><span class="line">            <span class="mxinfo " id="T1:U1421"><span class="var type1" id="S3T1U1902">v</span>       = <span class="mxinfo " id="T1:U1423"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U1424"><span class="var type1" id="S16T1U1906">K1</span> + <span class="mxinfo " id="T1:U1426"><span class="mxinfo " id="T1:U1427"><span class="mxinfo " id="T1:U1428">2</span> ./ <span class="var type1" id="S4T1U1910">r</span></span> * ( <span class="mxinfo " id="T1:U1430"><span class="mxinfo " id="T1:U1431">1</span> - <span class="var type1" id="S13T1U1914">ee</span></span> )</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,289" id="srcline289">289</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,290" id="srcline290">290</a></span><span class="line">            <span class="mxinfo " id="T1:U1433"><span class="var type1" id="S32T1U1917">cpsi</span>   = <span class="mxinfo " id="T1:U1435"><span class="var type1" id="S20T1U1919">regime0</span> .* ( <span class="mxinfo " id="T1:U1437"><span class="mxinfo " id="T1:U1438"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U1439"><span class="mxinfo " id="T1:U1440"><span class="potentialdiff PD1">( <span class="mxinfo " id="T1:U1441"><span class="mxinfo " id="T1:U1442"><span class="mxinfo " id="T1:U1443">2</span> * ( <span class="mxinfo " id="T1:U1444"><span class="mxinfo " id="T1:U1445">1</span> - <span class="var type1" id="S13T1U1933">ee</span></span> )</span> +  <span class="mxinfo " id="T1:U1447"><span class="var type1" id="S16T1U1935">K1</span> * <span class="var type1" id="S4T1U1936">r</span></span></span> ).^2</span></span> - <span class="mxinfo " id="T1:U1450"><span class="potentialdiff PD1"><span class="var type1" id="S17T1U1939">K2</span>^2</span></span></span> )</span></span> ./ ( <span class="mxinfo " id="T1:U1452"><span class="mxinfo " id="T1:U1453"><span class="mxinfo " id="T1:U1454">2</span> * ( <span class="mxinfo " id="T1:U1455"><span class="mxinfo " id="T1:U1456">1</span> - <span class="var type1" id="S13T1U1948">ee</span></span> )</span> + <span class="mxinfo " id="T1:U1458"><span class="var type1" id="S16T1U1950">K1</span> * <span class="var type1" id="S4T1U1951">r</span></span></span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,291" id="srcline291">291</a></span><span class="line">            <span class="mxinfo " id="T1:U1461"><span class="var type1" id="S33T1U1954">spsi</span>   = <span class="mxinfo " id="T1:U1463"><span class="var type1" id="S17T1U1956">K2</span> ./ ( <span class="mxinfo " id="T1:U1465"><span class="mxinfo " id="T1:U1466"><span class="mxinfo " id="T1:U1467">2</span> * ( <span class="mxinfo " id="T1:U1468"><span class="mxinfo " id="T1:U1469">1</span> - <span class="var type1" id="S13T1U1964">ee</span></span> )</span> + <span class="mxinfo " id="T1:U1471"><span class="var type1" id="S16T1U1966">K1</span> * <span class="var type1" id="S4T1U1967">r</span></span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,292" id="srcline292">292</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,293" id="srcline293">293</a></span><span class="line">            <span class="mxinfo " id="T1:U1474"><span class="var type1" id="S6T1U1970">psi</span>    =  <span class="mxinfo " id="T1:U1476">atan2( <span class="var type1" id="S33T1U1973">spsi</span> , <span class="var type1" id="S32T1U1974">cpsi</span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,294" id="srcline294">294</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,295" id="srcline295">295</a></span><span class="line">            <span class="comment">% Time of flight</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,296" id="srcline296">296</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,297" id="srcline297">297</a></span><span class="line">            <span class="mxinfo " id="T1:U1479"><span class="var type1" id="S68T1U1977">H0</span>       =  <span class="mxinfo " id="T1:U1481"><span class="var type1" id="S8T1U1979">v0</span> * <span class="mxinfo " id="T1:U1483"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U1484"><span class="var type1" id="S9T1U1983">r0</span> * ( <span class="mxinfo " id="T1:U1486"><span class="mxinfo " id="T1:U1487"><span class="var type1" id="S9T1U1987">r0</span> * <span class="mxinfo " id="T1:U1489"><span class="potentialdiff PD1"><span class="var type1" id="S8T1U1989">v0</span>^2</span></span></span> + <span class="mxinfo " id="T1:U1491"><span class="mxinfo " id="T1:U1492">2</span> * ( <span class="mxinfo " id="T1:U1493"><span class="mxinfo " id="T1:U1494">1</span> - <span class="var type1" id="S13T1U1996">ee</span></span> )</span></span> )</span> )</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,298" id="srcline298">298</a></span><span class="line">            <span class="mxinfo " id="T1:U1496"><span class="var type1" id="S69T1U1999">Hf</span>       =  <span class="mxinfo " id="T1:U1498"><span class="var type1" id="S3T1U2001">v</span> .* <span class="mxinfo " id="T1:U1500"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U1501"><span class="var type1" id="S4T1U2005">r</span> .* ( <span class="mxinfo " id="T1:U1503"><span class="mxinfo " id="T1:U1504"><span class="var type1" id="S4T1U2009">r</span> .* <span class="mxinfo " id="T1:U1506"><span class="potentialdiff PD1"><span class="var type1" id="S3T1U2011">v</span>.^2</span></span></span> + <span class="mxinfo " id="T1:U1508"><span class="mxinfo " id="T1:U1509">2</span> * ( <span class="mxinfo " id="T1:U1510"><span class="mxinfo " id="T1:U1511">1</span> - <span class="var type1" id="S13T1U2018">ee</span></span> )</span></span> )</span> )</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,299" id="srcline299">299</a></span><span class="line">            <span class="mxinfo " id="T1:U1513"><span class="var type1" id="S2T1U2021">Time</span>     =  <span class="mxinfo " id="T1:U1515"><span class="mxinfo " id="T1:U1516"><span class="mxinfo " id="T1:U1517"><span class="var type1" id="S20T1U2025">regime0</span> * <span class="mxinfo " id="T1:U1519">1</span></span> / <span class="mxinfo " id="T1:U1520"><span class="potentialdiff PD1"><span class="var type1" id="S16T1U2028">K1</span>^(3/2)</span></span></span> * ( <span class="mxinfo " id="T1:U1522"><span class="mxinfo " id="T1:U1523"><span class="var type1" id="S69T1U2036">Hf</span> - <span class="var type1" id="S68T1U2037">H0</span></span> + <span class="mxinfo " id="T1:U1526">( <span class="mxinfo " id="T1:U1527"><span class="mxinfo " id="T1:U1528">1</span> - <span class="var type1" id="S13T1U2042">ee</span></span> ) * <span class="mxinfo " id="T1:U1530"><span class="potentialdiff PD1">log ( <span class="mxinfo " id="T1:U1531">( <span class="mxinfo " id="T1:U1532"><span class="mxinfo " id="T1:U1533"><span class="mxinfo " id="T1:U1534"><span class="mxinfo " id="T1:U1535"><span class="var type1" id="S9T1U2051">r0</span> * <span class="mxinfo " id="T1:U1537"><span class="potentialdiff PD1"><span class="var type1" id="S8T1U2053">v0</span>^2</span></span></span> + <span class="mxinfo " id="T1:U1539">1</span></span> - <span class="var type1" id="S13T1U2056">ee</span></span> + <span class="var type1" id="S68T1U2057">H0</span></span> ) / (  <span class="mxinfo " id="T1:U1542"><span class="mxinfo " id="T1:U1543"><span class="mxinfo " id="T1:U1544"><span class="mxinfo " id="T1:U1545"><span class="var type1" id="S4T1U2063">r</span> * <span class="mxinfo " id="T1:U1547"><span class="potentialdiff PD1"><span class="var type1" id="S3T1U2065">v</span>^2</span></span></span> + <span class="mxinfo " id="T1:U1549">1</span></span> - <span class="var type1" id="S13T1U2068">ee</span></span> + <span class="var type1" id="S69T1U2069">Hf</span></span>)</span>)</span></span></span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,300" id="srcline300">300</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,301" id="srcline301">301</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,302" id="srcline302">302</a></span><span class="line">    <span class="keyword">else</span>  <span class="comment">% Parabolic spiral</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,303" id="srcline303">303</a></span><span class="line">        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,304" id="srcline304">304</a></span><span class="line">        <span class="comment">% THE FLIGHT PATH ANGLE REMAINS CONSTANT</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,305" id="srcline305">305</a></span><span class="line">        <span class="comment">% THE PARTICLE REACHES INFINITY WITH A ZERO VELOCITY</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,306" id="srcline306">306</a></span><span class="line">        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,307" id="srcline307">307</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,308" id="srcline308">308</a></span><span class="line">        <span class="mxinfo " id="T1:U1552"><span class="var type1" id="S24T1U2073">ell</span>     = <span class="mxinfo " id="T1:U1554"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U1555"><span class="mxinfo " id="T1:U1556"><span class="mxinfo " id="T1:U1557">4</span> * <span class="mxinfo " id="T1:U1558"><span class="potentialdiff PD1">( <span class="mxinfo " id="T1:U1559"><span class="mxinfo " id="T1:U1560">1</span> - <span class="var type1" id="S13T1U2083">ee</span></span> )^2</span></span></span> - <span class="mxinfo " id="T1:U1562"><span class="potentialdiff PD1"><span class="var type1" id="S17T1U2086">K2</span>^2</span></span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,309" id="srcline309">309</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,310" id="srcline310">310</a></span><span class="line">        <span class="mxinfo " id="T1:U1564"><span class="var type1" id="S4T1U2090">r</span>       = <span class="mxinfo " id="T1:U1566"><span class="var type1" id="S9T1U2092">r0</span> * <span class="mxinfo " id="T1:U1568">exp( <span class="mxinfo " id="T1:U1569"><span class="mxinfo " id="T1:U1570"><span class="mxinfo " id="T1:U1571"><span class="var type1" id="S20T1U2098">regime0</span> * <span class="var type1" id="S24T1U2099">ell</span></span> * ( <span class="mxinfo " id="T1:U1574"><span class="var type1" id="S5T1U2102">theta</span> - <span class="var type1" id="S10T1U2103">theta0</span></span> )</span> / <span class="var type1" id="S17T1U2104">K2</span></span> )</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,311" id="srcline311">311</a></span><span class="line">        <span class="mxinfo " id="T1:U1578"><span class="var type1" id="S3T1U2107">v</span>       = <span class="mxinfo " id="T1:U1580"><span class="potentialdiff PD1">sqrt ( <span class="mxinfo " id="T1:U1581"><span class="var type1" id="S16T1U2111">K1</span> + <span class="mxinfo " id="T1:U1583"><span class="mxinfo " id="T1:U1584"><span class="mxinfo " id="T1:U1585">2</span> ./ <span class="var type1" id="S4T1U2115">r</span></span> * ( <span class="mxinfo " id="T1:U1587"><span class="mxinfo " id="T1:U1588">1</span> - <span class="var type1" id="S13T1U2119">ee</span></span> )</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,312" id="srcline312">312</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,313" id="srcline313">313</a></span><span class="line">        <span class="mxinfo " id="T1:U1590"><span class="var type1" id="S6T1U2122">psi</span>     = <span class="mxinfo " id="T1:U1592"><span class="var type1" id="S11T1U2124">psi0</span>*<span class="mxinfo " id="T1:U1594">ones(size(<span class="var type1" id="S4T1U2129">r</span>))</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,314" id="srcline314">314</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,315" id="srcline315">315</a></span><span class="line">        <span class="comment">% Time of flight</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,316" id="srcline316">316</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,317" id="srcline317">317</a></span><span class="line">        <span class="mxinfo " id="T1:U1596"><span class="var type1" id="S2T1U2132">Time</span>       = <span class="mxinfo " id="T1:U1598"><span class="mxinfo " id="T1:U1599"><span class="mxinfo " id="T1:U1600"><span class="mxinfo " id="T1:U1601"><span class="mxinfo " id="T1:U1602"><span class="var type1" id="S20T1U2138">regime0</span> * <span class="mxinfo " id="T1:U1604">2</span></span> * <span class="mxinfo " id="T1:U1605"><span class="potentialdiff PD1">sqrt( <span class="mxinfo " id="T1:U1606"><span class="mxinfo " id="T1:U1607">2</span> * ( <span class="mxinfo " id="T1:U1608"><span class="mxinfo " id="T1:U1609">1</span> - <span class="var type1" id="S13T1U2147">ee</span></span> )</span> )</span></span></span> / <span class="mxinfo " id="T1:U1611">3</span></span> / <span class="var type1" id="S24T1U2149">ell</span></span> * ( <span class="mxinfo " id="T1:U1613"><span class="mxinfo " id="T1:U1614"><span class="potentialdiff PD1"><span class="var type1" id="S4T1U2153">r</span>.^(3/2)</span></span> - <span class="mxinfo " id="T1:U1616"><span class="potentialdiff PD1"><span class="var type1" id="S9T1U2159">r0</span>^(3/2)</span></span></span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,318" id="srcline318">318</a></span><span class="line">        <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,319" id="srcline319">319</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,320" id="srcline320">320</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,321" id="srcline321">321</a></span><span class="line">    <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,322" id="srcline322">322</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,323" id="srcline323">323</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,324" id="srcline324">324</a></span><span class="line">    <span class="var type0" id="S2T0U2167">Time</span>  = -1.0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,325" id="srcline325">325</a></span><span class="line">    <span class="var type0" id="S3T0U2172">v</span>     = -1.0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,326" id="srcline326">326</a></span><span class="line">    <span class="var type0" id="S4T0U2177">r</span>     = -1.0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,327" id="srcline327">327</a></span><span class="line">    <span class="var type0" id="S5T0U2182">theta</span> = -1.0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,328" id="srcline328">328</a></span><span class="line">    <span class="var type0" id="S6T0U2187">psi</span>   = -1.0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,329" id="srcline329">329</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,330" id="srcline330">330</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,331" id="srcline331">331</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T2:U1618">isnan(<span class="var type1" id="S2T1U2194">Time</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,332" id="srcline332">332</a></span><span class="line">    <span class="mxinfo " id="T1:U1620"><span class="var type1" id="S2T1U2197">Time</span> = <span class="mxinfo " id="T1:U1622">-<span class="mxinfo " id="T1:U1623">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,333" id="srcline333">333</a></span><span class="line">    <span class="mxinfo " id="T1:U1624"><span class="var type1" id="S7T1U2202">flag</span> = <span class="mxinfo " id="T1:U1626">-<span class="mxinfo " id="T1:U1627">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,334" id="srcline334">334</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,335" id="srcline335">335</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,336" id="srcline336">336</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T2:U1628"><span class="var type1" id="S7T1U2208">flag</span> == <span class="mxinfo " id="T1:U1630">-<span class="mxinfo " id="T1:U1631">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,337" id="srcline337">337</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,338" id="srcline338">338</a></span><span class="line">    <span class="mxinfo " id="T1:U1632"><span class="var type1" id="S2T1U2213">Time</span>  = <span class="mxinfo " id="T1:U1634">-<span class="mxinfo " id="T1:U1635">1.0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,339" id="srcline339">339</a></span><span class="line">    <span class="mxinfo " id="T1:U1636"><span class="var type1" id="S3T1U2218">v</span>     = <span class="mxinfo " id="T1:U1638">-<span class="mxinfo " id="T1:U1639">1.0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,340" id="srcline340">340</a></span><span class="line">    <span class="mxinfo " id="T1:U1640"><span class="var type1" id="S4T1U2223">r</span>     = <span class="mxinfo " id="T1:U1642">-<span class="mxinfo " id="T1:U1643">1.0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,341" id="srcline341">341</a></span><span class="line">    <span class="mxinfo " id="T1:U1644"><span class="var type1" id="S5T1U2228">theta</span> = <span class="mxinfo " id="T1:U1646">-<span class="mxinfo " id="T1:U1647">1.0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,342" id="srcline342">342</a></span><span class="line">    <span class="mxinfo " id="T1:U1648"><span class="var type1" id="S6T1U2233">psi</span>   = <span class="mxinfo " id="T1:U1650">-<span class="mxinfo " id="T1:U1651">1.0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,343" id="srcline343">343</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,344" id="srcline344">344</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,345" id="srcline345">345</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,346" id="srcline346">346</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,347" id="srcline347">347</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,348" id="srcline348">348</a></span><span class="line"></span></span>
</pre>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,349" id="srcline349">349</a></span><span class="line">function EL3 = ELIT3(PHI,HK,C)</span></span>
<span class="srcline"><span class="lineno"><a href="1,350" id="srcline350">350</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,351" id="srcline351">351</a></span><span class="line"><span class="comment">%       =========================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,352" id="srcline352">352</a></span><span class="line"><span class="comment">%       Purpose: Compute the elliptic integral of the third kind</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,353" id="srcline353">353</a></span><span class="line"><span class="comment">%                using Gauss-Legendre quadrature</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,354" id="srcline354">354</a></span><span class="line"><span class="comment">%       Input :  Phi --- Argument ( in degrees )</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,355" id="srcline355">355</a></span><span class="line"><span class="comment">%                 k  --- Modulus   ( 0  k  1.0 )</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,356" id="srcline356">356</a></span><span class="line"><span class="comment">%                 c  --- Parameter ( 0  c  1.0 )</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,357" id="srcline357">357</a></span><span class="line"><span class="comment">%       Output:  EL3 --- Value of the elliptic integral of the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,358" id="srcline358">358</a></span><span class="line"><span class="comment">%                        third kind</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,359" id="srcline359">359</a></span><span class="line"><span class="comment">%       =========================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,360" id="srcline360">360</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,361" id="srcline361">361</a></span><span class="line">T = [ .9931285991850949,.9639719272779138,...</span></span>
<span class="srcline"><span class="lineno"><a href="1,362" id="srcline362">362</a></span><span class="line">    .9122344282513259,.8391169718222188,...</span></span>
<span class="srcline"><span class="lineno"><a href="1,363" id="srcline363">363</a></span><span class="line">    .7463319064601508,.6360536807265150,...</span></span>
<span class="srcline"><span class="lineno"><a href="1,364" id="srcline364">364</a></span><span class="line">    .5108670019508271,.3737060887154195,...</span></span>
<span class="srcline"><span class="lineno"><a href="1,365" id="srcline365">365</a></span><span class="line">    .2277858511416451,.7652652113349734E-1];</span></span>
<span class="srcline"><span class="lineno"><a href="1,366" id="srcline366">366</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,367" id="srcline367">367</a></span><span class="line">W = [ .1761400713915212E-1,.4060142980038694E-1,...</span></span>
<span class="srcline"><span class="lineno"><a href="1,368" id="srcline368">368</a></span><span class="line">    .6267204833410907E-1,.8327674157670475E-1,...</span></span>
<span class="srcline"><span class="lineno"><a href="1,369" id="srcline369">369</a></span><span class="line">    .1019301198172404,.1181945319615184,...</span></span>
<span class="srcline"><span class="lineno"><a href="1,370" id="srcline370">370</a></span><span class="line">    .1316886384491766,.1420961093183820,...</span></span>
<span class="srcline"><span class="lineno"><a href="1,371" id="srcline371">371</a></span><span class="line">    .1491729864726037,.1527533871307258];</span></span>
<span class="srcline"><span class="lineno"><a href="1,372" id="srcline372">372</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,373" id="srcline373">373</a></span><span class="line">LB1= isequal(HK,1.0E0) &amp;&amp; (abs(PHI-90.0)&lt;=1.0E-8);</span></span>
<span class="srcline"><span class="lineno"><a href="1,374" id="srcline374">374</a></span><span class="line">LB2= isequal(C,1.0E0)  &amp;&amp; (abs(PHI-90.0)&lt;=1.0E-8);</span></span>
<span class="srcline"><span class="lineno"><a href="1,375" id="srcline375">375</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,376" id="srcline376">376</a></span><span class="line">if (LB1 || LB2)</span></span>
<span class="srcline"><span class="lineno"><a href="1,377" id="srcline377">377</a></span><span class="line">    EL3=NaN;</span></span>
<span class="srcline"><span class="lineno"><a href="1,378" id="srcline378">378</a></span><span class="line">    return</span></span>
<span class="srcline"><span class="lineno"><a href="1,379" id="srcline379">379</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,380" id="srcline380">380</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,381" id="srcline381">381</a></span><span class="line">C1=0.87266462599716E-2*PHI;</span></span>
<span class="srcline"><span class="lineno"><a href="1,382" id="srcline382">382</a></span><span class="line">C2=C1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,383" id="srcline383">383</a></span><span class="line">EL3=0.0E0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,384" id="srcline384">384</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,385" id="srcline385">385</a></span><span class="line">for I=1:10</span></span>
<span class="srcline"><span class="lineno"><a href="1,386" id="srcline386">386</a></span><span class="line">    <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,387" id="srcline387">387</a></span><span class="line">    C0=C2*T(I);</span></span>
<span class="srcline"><span class="lineno"><a href="1,388" id="srcline388">388</a></span><span class="line">    T1=C1+C0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,389" id="srcline389">389</a></span><span class="line">    T2=C1-C0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,390" id="srcline390">390</a></span><span class="line">    <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,391" id="srcline391">391</a></span><span class="line">    F1=1.0E0/((1.0E0-C*sin(T1)*sin(T1))* ...</span></span>
<span class="srcline"><span class="lineno"><a href="1,392" id="srcline392">392</a></span><span class="line">        sqrt(1.0E0-HK*HK*sin(T1)*sin(T1)));</span></span>
<span class="srcline"><span class="lineno"><a href="1,393" id="srcline393">393</a></span><span class="line">    <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,394" id="srcline394">394</a></span><span class="line">    F2=1.0E0/((1.0E0-C*sin(T2)*sin(T2))* ...</span></span>
<span class="srcline"><span class="lineno"><a href="1,395" id="srcline395">395</a></span><span class="line">        sqrt(1.0E0-HK*HK*sin(T2)*sin(T2)));</span></span>
<span class="srcline"><span class="lineno"><a href="1,396" id="srcline396">396</a></span><span class="line">    <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,397" id="srcline397">397</a></span><span class="line">    EL3=EL3+W(I)*(F1+F2);</span></span>
<span class="srcline"><span class="lineno"><a href="1,398" id="srcline398">398</a></span><span class="line">    <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,399" id="srcline399">399</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,400" id="srcline400">400</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,401" id="srcline401">401</a></span><span class="line">EL3=C1*EL3;</span></span>
<span class="srcline"><span class="lineno"><a href="1,402" id="srcline402">402</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,403" id="srcline403">403</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,404" id="srcline404">404</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,405" id="srcline405">405</a></span><span class="line">function   [FE,EE] = ELIT(HK,PHI)</span></span>
<span class="srcline"><span class="lineno"><a href="1,406" id="srcline406">406</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,407" id="srcline407">407</a></span><span class="line"><span class="comment">%       ==================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,408" id="srcline408">408</a></span><span class="line"><span class="comment">%       Purpose: Compute complete and incomplete elliptic</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,409" id="srcline409">409</a></span><span class="line"><span class="comment">%                integrals F(k,phi) and E(k,phi)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,410" id="srcline410">410</a></span><span class="line"><span class="comment">%       Input  : HK  --- Modulus k ( 0  k  1 )</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,411" id="srcline411">411</a></span><span class="line"><span class="comment">%                Phi --- Argument ( in degrees )</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,412" id="srcline412">412</a></span><span class="line"><span class="comment">%       Output : FE  --- F(k,phi)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,413" id="srcline413">413</a></span><span class="line"><span class="comment">%                EE  --- E(k,phi)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,414" id="srcline414">414</a></span><span class="line"><span class="comment">%       ==================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,415" id="srcline415">415</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,416" id="srcline416">416</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,417" id="srcline417">417</a></span><span class="line">G  = 0.0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,418" id="srcline418">418</a></span><span class="line">PI = 3.14159265358979;</span></span>
<span class="srcline"><span class="lineno"><a href="1,419" id="srcline419">419</a></span><span class="line">A0 = 1.0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,420" id="srcline420">420</a></span><span class="line">B0 = sqrt(1.0-HK*HK);</span></span>
<span class="srcline"><span class="lineno"><a href="1,421" id="srcline421">421</a></span><span class="line">D0 = (PI/180.0)*PHI;</span></span>
<span class="srcline"><span class="lineno"><a href="1,422" id="srcline422">422</a></span><span class="line">R  = HK*HK;</span></span>
<span class="srcline"><span class="lineno"><a href="1,423" id="srcline423">423</a></span><span class="line">D  = 0.0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,424" id="srcline424">424</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,425" id="srcline425">425</a></span><span class="line">if (isequal(HK,1.0) &amp;&amp; isequal(PHI,90.0) )</span></span>
<span class="srcline"><span class="lineno"><a href="1,426" id="srcline426">426</a></span><span class="line">    FE=NaN;</span></span>
<span class="srcline"><span class="lineno"><a href="1,427" id="srcline427">427</a></span><span class="line">    EE=1.0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,428" id="srcline428">428</a></span><span class="line">elseif isequal(HK,1.0)</span></span>
<span class="srcline"><span class="lineno"><a href="1,429" id="srcline429">429</a></span><span class="line">    FE=log((1.0+sin(D0))/cos(D0));</span></span>
<span class="srcline"><span class="lineno"><a href="1,430" id="srcline430">430</a></span><span class="line">    EE=sin(D0);</span></span>
<span class="srcline"><span class="lineno"><a href="1,431" id="srcline431">431</a></span><span class="line">else</span></span>
<span class="srcline"><span class="lineno"><a href="1,432" id="srcline432">432</a></span><span class="line">    FAC=1.0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,433" id="srcline433">433</a></span><span class="line">    for N=1:40</span></span>
<span class="srcline"><span class="lineno"><a href="1,434" id="srcline434">434</a></span><span class="line">        A=(A0+B0)/2.0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,435" id="srcline435">435</a></span><span class="line">        B=sqrt(A0*B0);</span></span>
<span class="srcline"><span class="lineno"><a href="1,436" id="srcline436">436</a></span><span class="line">        C=(A0-B0)/2.0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,437" id="srcline437">437</a></span><span class="line">        FAC=2.0*FAC;</span></span>
<span class="srcline"><span class="lineno"><a href="1,438" id="srcline438">438</a></span><span class="line">        R=R+FAC*C*C;</span></span>
<span class="srcline"><span class="lineno"><a href="1,439" id="srcline439">439</a></span><span class="line">        if ~isequal(PHI,90.0)</span></span>
<span class="srcline"><span class="lineno"><a href="1,440" id="srcline440">440</a></span><span class="line">            D=D0+atan((B0/A0)*tan(D0));</span></span>
<span class="srcline"><span class="lineno"><a href="1,441" id="srcline441">441</a></span><span class="line">            G=G+C*sin(D);</span></span>
<span class="srcline"><span class="lineno"><a href="1,442" id="srcline442">442</a></span><span class="line">            D0=D+PI*floor(D/PI+.5);</span></span>
<span class="srcline"><span class="lineno"><a href="1,443" id="srcline443">443</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="1,444" id="srcline444">444</a></span><span class="line">        A0=A;</span></span>
<span class="srcline"><span class="lineno"><a href="1,445" id="srcline445">445</a></span><span class="line">        B0=B;</span></span>
<span class="srcline"><span class="lineno"><a href="1,446" id="srcline446">446</a></span><span class="line">        if (C&lt;1.0e-7)</span></span>
<span class="srcline"><span class="lineno"><a href="1,447" id="srcline447">447</a></span><span class="line">            break</span></span>
<span class="srcline"><span class="lineno"><a href="1,448" id="srcline448">448</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="1,449" id="srcline449">449</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="1,450" id="srcline450">450</a></span><span class="line">    CK=PI/(2.0*A);</span></span>
<span class="srcline"><span class="lineno"><a href="1,451" id="srcline451">451</a></span><span class="line">    CE=PI*(2.0-R)/(4.0*A);</span></span>
<span class="srcline"><span class="lineno"><a href="1,452" id="srcline452">452</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,453" id="srcline453">453</a></span><span class="line">    if isequal(PHI,90.0)</span></span>
<span class="srcline"><span class="lineno"><a href="1,454" id="srcline454">454</a></span><span class="line">        FE=CK;</span></span>
<span class="srcline"><span class="lineno"><a href="1,455" id="srcline455">455</a></span><span class="line">        EE=CE;</span></span>
<span class="srcline"><span class="lineno"><a href="1,456" id="srcline456">456</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="1,457" id="srcline457">457</a></span><span class="line">        FE=D/(FAC*A);</span></span>
<span class="srcline"><span class="lineno"><a href="1,458" id="srcline458">458</a></span><span class="line">        EE=FE*CE/CK+G;</span></span>
<span class="srcline"><span class="lineno"><a href="1,459" id="srcline459">459</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="1,460" id="srcline460">460</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,461" id="srcline461">461</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,462" id="srcline462">462</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,463" id="srcline463">463</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,464" id="srcline464">464</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,465" id="srcline465">465</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,466" id="srcline466">466</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,467" id="srcline467">467</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,468" id="srcline468">468</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,469" id="srcline469">469</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,470" id="srcline470">470</a></span><span class="line"> </span></span>
</pre>
</div>
</body>
</html>
